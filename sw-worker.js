(()=>{var sn=Object.create;var ir=Object.defineProperty;var on=Object.getOwnPropertyDescriptor;var an=Object.getOwnPropertyNames;var cn=Object.getPrototypeOf,un=Object.prototype.hasOwnProperty;var x=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var ln=(t,e,r,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of an(e))!un.call(t,a)&&a!==r&&ir(t,a,{get:()=>e[a],enumerable:!(i=on(e,a))||i.enumerable});return t};var Oe=(t,e,r)=>(r=t!=null?sn(cn(t)):{},ln(e||!t||!t.__esModule?ir(r,"default",{value:t,enumerable:!0}):r,t));var F=x(He=>{"use strict";Object.defineProperty(He,"__esModule",{value:!0});var Be;function We(){if(Be===void 0)throw new Error("No runtime abstraction layer installed");return Be}(function(t){function e(r){if(r===void 0)throw new Error("No runtime abstraction layer provided");Be=r}t.install=e})(We||(We={}));He.default=We});var Ue=x(be=>{"use strict";Object.defineProperty(be,"__esModule",{value:!0});be.Disposable=void 0;var dn;(function(t){function e(r){return{dispose:r}}t.create=e})(dn=be.Disposable||(be.Disposable={}))});var ne=x(re=>{"use strict";Object.defineProperty(re,"__esModule",{value:!0});re.Emitter=re.Event=void 0;var fn=F(),hn;(function(t){let e={dispose(){}};t.None=function(){return e}})(hn=re.Event||(re.Event={}));var Ve=class{add(e,r=null,i){this._callbacks||(this._callbacks=[],this._contexts=[]),this._callbacks.push(e),this._contexts.push(r),Array.isArray(i)&&i.push({dispose:()=>this.remove(e,r)})}remove(e,r=null){if(!this._callbacks)return;let i=!1;for(let a=0,h=this._callbacks.length;a<h;a++)if(this._callbacks[a]===e)if(this._contexts[a]===r){this._callbacks.splice(a,1),this._contexts.splice(a,1);return}else i=!0;if(i)throw new Error("When adding a listener with a context, you should remove it with the same context")}invoke(...e){if(!this._callbacks)return[];let r=[],i=this._callbacks.slice(0),a=this._contexts.slice(0);for(let h=0,E=i.length;h<E;h++)try{r.push(i[h].apply(a[h],e))}catch(L){fn.default().console.error(L)}return r}isEmpty(){return!this._callbacks||this._callbacks.length===0}dispose(){this._callbacks=void 0,this._contexts=void 0}},le=class{constructor(e){this._options=e}get event(){return this._event||(this._event=(e,r,i)=>{this._callbacks||(this._callbacks=new Ve),this._options&&this._options.onFirstListenerAdd&&this._callbacks.isEmpty()&&this._options.onFirstListenerAdd(this),this._callbacks.add(e,r);let a={dispose:()=>{!this._callbacks||(this._callbacks.remove(e,r),a.dispose=le._noop,this._options&&this._options.onLastListenerRemove&&this._callbacks.isEmpty()&&this._options.onLastListenerRemove(this))}};return Array.isArray(i)&&i.push(a),a}),this._event}fire(e){this._callbacks&&this._callbacks.invoke.call(this._callbacks,e)}dispose(){this._callbacks&&(this._callbacks.dispose(),this._callbacks=void 0)}};re.Emitter=le;le._noop=function(){}});var sr=x(xe=>{"use strict";Object.defineProperty(xe,"__esModule",{value:!0});xe.AbstractMessageBuffer=void 0;var pn=13,mn=10,gn=`\r
`,Qe=class{constructor(e="utf-8"){this._encoding=e,this._chunks=[],this._totalLength=0}get encoding(){return this._encoding}append(e){let r=typeof e=="string"?this.fromString(e,this._encoding):e;this._chunks.push(r),this._totalLength+=r.byteLength}tryReadHeaders(){if(this._chunks.length===0)return;let e=0,r=0,i=0,a=0;e:for(;r<this._chunks.length;){let _=this._chunks[r];i=0;t:for(;i<_.length;){switch(_[i]){case pn:switch(e){case 0:e=1;break;case 2:e=3;break;default:e=0}break;case mn:switch(e){case 1:e=2;break;case 3:e=4,i++;break e;default:e=0}break;default:e=0}i++}a+=_.byteLength,r++}if(e!==4)return;let h=this._read(a+i),E=new Map,L=this.toString(h,"ascii").split(gn);if(L.length<2)return E;for(let _=0;_<L.length-2;_++){let q=L[_],D=q.indexOf(":");if(D===-1)throw new Error("Message header must separate key and value using :");let X=q.substr(0,D),oe=q.substr(D+1).trim();E.set(X,oe)}return E}tryReadBody(e){if(!(this._totalLength<e))return this._read(e)}get numberOfBytes(){return this._totalLength}_read(e){if(e===0)return this.emptyBuffer();if(e>this._totalLength)throw new Error("Cannot read so many bytes!");if(this._chunks[0].byteLength===e){let h=this._chunks[0];return this._chunks.shift(),this._totalLength-=e,this.asNative(h)}if(this._chunks[0].byteLength>e){let h=this._chunks[0],E=this.asNative(h,e);return this._chunks[0]=h.slice(e),this._totalLength-=e,E}let r=this.allocNative(e),i=0,a=0;for(;e>0;){let h=this._chunks[a];if(h.byteLength>e){let E=h.slice(0,e);r.set(E,i),i+=e,this._chunks[a]=h.slice(e),this._totalLength-=e,e-=e}else r.set(h,i),i+=h.byteLength,this._chunks.shift(),this._totalLength-=h.byteLength,e-=h.byteLength}return r}};xe.AbstractMessageBuffer=Qe});var ar=x(Ye=>{"use strict";Object.defineProperty(Ye,"__esModule",{value:!0});var yn=F(),de=Ue(),bn=ne(),_n=sr(),fe=class extends _n.AbstractMessageBuffer{constructor(e="utf-8"){super(e),this.asciiDecoder=new TextDecoder("ascii")}emptyBuffer(){return fe.emptyBuffer}fromString(e,r){return new TextEncoder().encode(e)}toString(e,r){return r==="ascii"?this.asciiDecoder.decode(e):new TextDecoder(r).decode(e)}asNative(e,r){return r===void 0?e:e.slice(0,r)}allocNative(e){return new Uint8Array(e)}};fe.emptyBuffer=new Uint8Array(0);var Ke=class{constructor(e){this.socket=e,this._onData=new bn.Emitter,this._messageListener=r=>{r.data.arrayBuffer().then(a=>{this._onData.fire(new Uint8Array(a))})},this.socket.addEventListener("message",this._messageListener)}onClose(e){return this.socket.addEventListener("close",e),de.Disposable.create(()=>this.socket.removeEventListener("close",e))}onError(e){return this.socket.addEventListener("error",e),de.Disposable.create(()=>this.socket.removeEventListener("error",e))}onEnd(e){return this.socket.addEventListener("end",e),de.Disposable.create(()=>this.socket.removeEventListener("end",e))}onData(e){return this._onData.event(e)}},Ge=class{constructor(e){this.socket=e}onClose(e){return this.socket.addEventListener("close",e),de.Disposable.create(()=>this.socket.removeEventListener("close",e))}onError(e){return this.socket.addEventListener("error",e),de.Disposable.create(()=>this.socket.removeEventListener("error",e))}onEnd(e){return this.socket.addEventListener("end",e),de.Disposable.create(()=>this.socket.removeEventListener("end",e))}write(e,r){if(typeof e=="string"){if(r!==void 0&&r!=="utf-8")throw new Error(`In a Browser environments only utf-8 text encding is supported. But got encoding: ${r}`);this.socket.send(e)}else this.socket.send(e);return Promise.resolve()}end(){this.socket.close()}},vn=new TextEncoder,or=Object.freeze({messageBuffer:Object.freeze({create:t=>new fe(t)}),applicationJson:Object.freeze({encoder:Object.freeze({name:"application/json",encode:(t,e)=>{if(e.charset!=="utf-8")throw new Error(`In a Browser environments only utf-8 text encding is supported. But got encoding: ${e.charset}`);return Promise.resolve(vn.encode(JSON.stringify(t,void 0,0)))}}),decoder:Object.freeze({name:"application/json",decode:(t,e)=>{if(!(t instanceof Uint8Array))throw new Error("In a Browser environments only Uint8Arrays are supported.");return Promise.resolve(JSON.parse(new TextDecoder(e.charset).decode(t)))}})}),stream:Object.freeze({asReadableStream:t=>new Ke(t),asWritableStream:t=>new Ge(t)}),console,timer:Object.freeze({setTimeout(t,e,...r){return setTimeout(t,e,...r)},clearTimeout(t){clearTimeout(t)},setImmediate(t,...e){return setTimeout(t,0,...e)},clearImmediate(t){clearTimeout(t)}})});function Xe(){return or}(function(t){function e(){yn.default.install(or)}t.install=e})(Xe||(Xe={}));Ye.default=Xe});var he=x(M=>{"use strict";Object.defineProperty(M,"__esModule",{value:!0});M.stringArray=M.array=M.func=M.error=M.number=M.string=M.boolean=void 0;function wn(t){return t===!0||t===!1}M.boolean=wn;function cr(t){return typeof t=="string"||t instanceof String}M.string=cr;function En(t){return typeof t=="number"||t instanceof Number}M.number=En;function Rn(t){return t instanceof Error}M.error=Rn;function Tn(t){return typeof t=="function"}M.func=Tn;function ur(t){return Array.isArray(t)}M.array=ur;function Sn(t){return ur(t)&&t.every(e=>cr(e))}M.stringArray=Sn});var wt=x(u=>{"use strict";Object.defineProperty(u,"__esModule",{value:!0});u.isResponseMessage=u.isNotificationMessage=u.isRequestMessage=u.NotificationType9=u.NotificationType8=u.NotificationType7=u.NotificationType6=u.NotificationType5=u.NotificationType4=u.NotificationType3=u.NotificationType2=u.NotificationType1=u.NotificationType0=u.NotificationType=u.RequestType9=u.RequestType8=u.RequestType7=u.RequestType6=u.RequestType5=u.RequestType4=u.RequestType3=u.RequestType2=u.RequestType1=u.RequestType=u.RequestType0=u.AbstractMessageSignature=u.ParameterStructures=u.ResponseError=u.ErrorCodes=void 0;var ie=he(),lr;(function(t){t.ParseError=-32700,t.InvalidRequest=-32600,t.MethodNotFound=-32601,t.InvalidParams=-32602,t.InternalError=-32603,t.jsonrpcReservedErrorRangeStart=-32099,t.serverErrorStart=t.jsonrpcReservedErrorRangeStart,t.MessageWriteError=-32099,t.MessageReadError=-32098,t.ServerNotInitialized=-32002,t.UnknownErrorCode=-32001,t.jsonrpcReservedErrorRangeEnd=-32e3,t.serverErrorEnd=t.jsonrpcReservedErrorRangeEnd})(lr=u.ErrorCodes||(u.ErrorCodes={}));var _e=class extends Error{constructor(e,r,i){super(r),this.code=ie.number(e)?e:lr.UnknownErrorCode,this.data=i,Object.setPrototypeOf(this,_e.prototype)}toJson(){return{code:this.code,message:this.message,data:this.data}}};u.ResponseError=_e;var C=class{constructor(e){this.kind=e}static is(e){return e===C.auto||e===C.byName||e===C.byPosition}toString(){return this.kind}};u.ParameterStructures=C;C.auto=new C("auto");C.byPosition=new C("byPosition");C.byName=new C("byName");var y=class{constructor(e,r){this.method=e,this.numberOfParams=r}get parameterStructures(){return C.auto}};u.AbstractMessageSignature=y;var Ze=class extends y{constructor(e){super(e,0)}};u.RequestType0=Ze;var et=class extends y{constructor(e,r=C.auto){super(e,1),this._parameterStructures=r}get parameterStructures(){return this._parameterStructures}};u.RequestType=et;var tt=class extends y{constructor(e,r=C.auto){super(e,1),this._parameterStructures=r}get parameterStructures(){return this._parameterStructures}};u.RequestType1=tt;var rt=class extends y{constructor(e){super(e,2)}};u.RequestType2=rt;var nt=class extends y{constructor(e){super(e,3)}};u.RequestType3=nt;var it=class extends y{constructor(e){super(e,4)}};u.RequestType4=it;var st=class extends y{constructor(e){super(e,5)}};u.RequestType5=st;var ot=class extends y{constructor(e){super(e,6)}};u.RequestType6=ot;var at=class extends y{constructor(e){super(e,7)}};u.RequestType7=at;var ct=class extends y{constructor(e){super(e,8)}};u.RequestType8=ct;var ut=class extends y{constructor(e){super(e,9)}};u.RequestType9=ut;var lt=class extends y{constructor(e,r=C.auto){super(e,1),this._parameterStructures=r}get parameterStructures(){return this._parameterStructures}};u.NotificationType=lt;var dt=class extends y{constructor(e){super(e,0)}};u.NotificationType0=dt;var ft=class extends y{constructor(e,r=C.auto){super(e,1),this._parameterStructures=r}get parameterStructures(){return this._parameterStructures}};u.NotificationType1=ft;var ht=class extends y{constructor(e){super(e,2)}};u.NotificationType2=ht;var pt=class extends y{constructor(e){super(e,3)}};u.NotificationType3=pt;var mt=class extends y{constructor(e){super(e,4)}};u.NotificationType4=mt;var gt=class extends y{constructor(e){super(e,5)}};u.NotificationType5=gt;var yt=class extends y{constructor(e){super(e,6)}};u.NotificationType6=yt;var bt=class extends y{constructor(e){super(e,7)}};u.NotificationType7=bt;var _t=class extends y{constructor(e){super(e,8)}};u.NotificationType8=_t;var vt=class extends y{constructor(e){super(e,9)}};u.NotificationType9=vt;function Nn(t){let e=t;return e&&ie.string(e.method)&&(ie.string(e.id)||ie.number(e.id))}u.isRequestMessage=Nn;function kn(t){let e=t;return e&&ie.string(e.method)&&t.id===void 0}u.isNotificationMessage=kn;function Cn(t){let e=t;return e&&(e.result!==void 0||!!e.error)&&(ie.string(e.id)||ie.number(e.id)||e.id===null)}u.isResponseMessage=Cn});var St=x(se=>{"use strict";Object.defineProperty(se,"__esModule",{value:!0});se.CancellationTokenSource=se.CancellationToken=void 0;var dr=F(),Pn=he(),Et=ne(),Rt;(function(t){t.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:Et.Event.None}),t.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:Et.Event.None});function e(r){let i=r;return i&&(i===t.None||i===t.Cancelled||Pn.boolean(i.isCancellationRequested)&&!!i.onCancellationRequested)}t.is=e})(Rt=se.CancellationToken||(se.CancellationToken={}));var On=Object.freeze(function(t,e){let r=dr.default().timer.setTimeout(t.bind(e),0);return{dispose(){dr.default().timer.clearTimeout(r)}}}),Me=class{constructor(){this._isCancelled=!1}cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?On:(this._emitter||(this._emitter=new Et.Emitter),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=void 0)}},Tt=class{get token(){return this._token||(this._token=new Me),this._token}cancel(){this._token?this._token.cancel():this._token=Rt.Cancelled}dispose(){this._token?this._token instanceof Me&&this._token.dispose():this._token=Rt.None}};se.CancellationTokenSource=Tt});var fr=x(B=>{"use strict";Object.defineProperty(B,"__esModule",{value:!0});B.ReadableStreamMessageReader=B.AbstractMessageReader=B.MessageReader=void 0;var qe=F(),pe=he(),Nt=ne(),xn;(function(t){function e(r){let i=r;return i&&pe.func(i.listen)&&pe.func(i.dispose)&&pe.func(i.onError)&&pe.func(i.onClose)&&pe.func(i.onPartialMessage)}t.is=e})(xn=B.MessageReader||(B.MessageReader={}));var je=class{constructor(){this.errorEmitter=new Nt.Emitter,this.closeEmitter=new Nt.Emitter,this.partialMessageEmitter=new Nt.Emitter}dispose(){this.errorEmitter.dispose(),this.closeEmitter.dispose()}get onError(){return this.errorEmitter.event}fireError(e){this.errorEmitter.fire(this.asError(e))}get onClose(){return this.closeEmitter.event}fireClose(){this.closeEmitter.fire(void 0)}get onPartialMessage(){return this.partialMessageEmitter.event}firePartialMessage(e){this.partialMessageEmitter.fire(e)}asError(e){return e instanceof Error?e:new Error(`Reader received error. Reason: ${pe.string(e.message)?e.message:"unknown"}`)}};B.AbstractMessageReader=je;var kt;(function(t){function e(r){var i;let a,h,E,L=new Map,_,q=new Map;if(r===void 0||typeof r=="string")a=r??"utf-8";else{if(a=(i=r.charset)!==null&&i!==void 0?i:"utf-8",r.contentDecoder!==void 0&&(E=r.contentDecoder,L.set(E.name,E)),r.contentDecoders!==void 0)for(let D of r.contentDecoders)L.set(D.name,D);if(r.contentTypeDecoder!==void 0&&(_=r.contentTypeDecoder,q.set(_.name,_)),r.contentTypeDecoders!==void 0)for(let D of r.contentTypeDecoders)q.set(D.name,D)}return _===void 0&&(_=qe.default().applicationJson.decoder,q.set(_.name,_)),{charset:a,contentDecoder:E,contentDecoders:L,contentTypeDecoder:_,contentTypeDecoders:q}}t.fromOptions=e})(kt||(kt={}));var Ct=class extends je{constructor(e,r){super(),this.readable=e,this.options=kt.fromOptions(r),this.buffer=qe.default().messageBuffer.create(this.options.charset),this._partialMessageTimeout=1e4,this.nextMessageLength=-1,this.messageToken=0}set partialMessageTimeout(e){this._partialMessageTimeout=e}get partialMessageTimeout(){return this._partialMessageTimeout}listen(e){this.nextMessageLength=-1,this.messageToken=0,this.partialMessageTimer=void 0,this.callback=e;let r=this.readable.onData(i=>{this.onData(i)});return this.readable.onError(i=>this.fireError(i)),this.readable.onClose(()=>this.fireClose()),r}onData(e){for(this.buffer.append(e);;){if(this.nextMessageLength===-1){let a=this.buffer.tryReadHeaders();if(!a)return;let h=a.get("Content-Length");if(!h)throw new Error("Header must provide a Content-Length property.");let E=parseInt(h);if(isNaN(E))throw new Error("Content-Length value must be a number.");this.nextMessageLength=E}let r=this.buffer.tryReadBody(this.nextMessageLength);if(r===void 0){this.setPartialMessageTimer();return}this.clearPartialMessageTimer(),this.nextMessageLength=-1;let i;this.options.contentDecoder!==void 0?i=this.options.contentDecoder.decode(r):i=Promise.resolve(r),i.then(a=>{this.options.contentTypeDecoder.decode(a,this.options).then(h=>{this.callback(h)},h=>{this.fireError(h)})},a=>{this.fireError(a)})}}clearPartialMessageTimer(){this.partialMessageTimer&&(qe.default().timer.clearTimeout(this.partialMessageTimer),this.partialMessageTimer=void 0)}setPartialMessageTimer(){this.clearPartialMessageTimer(),!(this._partialMessageTimeout<=0)&&(this.partialMessageTimer=qe.default().timer.setTimeout((e,r)=>{this.partialMessageTimer=void 0,e===this.messageToken&&(this.firePartialMessage({messageToken:e,waitingTime:r}),this.setPartialMessageTimer())},this._partialMessageTimeout,this.messageToken,this._partialMessageTimeout))}};B.ReadableStreamMessageReader=Ct});var hr=x(Le=>{"use strict";Object.defineProperty(Le,"__esModule",{value:!0});Le.Semaphore=void 0;var Mn=F(),Pt=class{constructor(e=1){if(e<=0)throw new Error("Capacity must be greater than 0");this._capacity=e,this._active=0,this._waiting=[]}lock(e){return new Promise((r,i)=>{this._waiting.push({thunk:e,resolve:r,reject:i}),this.runNext()})}get active(){return this._active}runNext(){this._waiting.length===0||this._active===this._capacity||Mn.default().timer.setImmediate(()=>this.doRunNext())}doRunNext(){if(this._waiting.length===0||this._active===this._capacity)return;let e=this._waiting.shift();if(this._active++,this._active>this._capacity)throw new Error("To many thunks active");try{let r=e.thunk();r instanceof Promise?r.then(i=>{this._active--,e.resolve(i),this.runNext()},i=>{this._active--,e.reject(i),this.runNext()}):(this._active--,e.resolve(r),this.runNext())}catch(r){this._active--,e.reject(r),this.runNext()}}};Le.Semaphore=Pt});var yr=x(W=>{"use strict";Object.defineProperty(W,"__esModule",{value:!0});W.WriteableStreamMessageWriter=W.AbstractMessageWriter=W.MessageWriter=void 0;var pr=F(),ve=he(),qn=hr(),mr=ne(),jn="Content-Length: ",gr=`\r
`,Ln;(function(t){function e(r){let i=r;return i&&ve.func(i.dispose)&&ve.func(i.onClose)&&ve.func(i.onError)&&ve.func(i.write)}t.is=e})(Ln=W.MessageWriter||(W.MessageWriter={}));var De=class{constructor(){this.errorEmitter=new mr.Emitter,this.closeEmitter=new mr.Emitter}dispose(){this.errorEmitter.dispose(),this.closeEmitter.dispose()}get onError(){return this.errorEmitter.event}fireError(e,r,i){this.errorEmitter.fire([this.asError(e),r,i])}get onClose(){return this.closeEmitter.event}fireClose(){this.closeEmitter.fire(void 0)}asError(e){return e instanceof Error?e:new Error(`Writer received error. Reason: ${ve.string(e.message)?e.message:"unknown"}`)}};W.AbstractMessageWriter=De;var Ot;(function(t){function e(r){var i,a;return r===void 0||typeof r=="string"?{charset:r??"utf-8",contentTypeEncoder:pr.default().applicationJson.encoder}:{charset:(i=r.charset)!==null&&i!==void 0?i:"utf-8",contentEncoder:r.contentEncoder,contentTypeEncoder:(a=r.contentTypeEncoder)!==null&&a!==void 0?a:pr.default().applicationJson.encoder}}t.fromOptions=e})(Ot||(Ot={}));var xt=class extends De{constructor(e,r){super(),this.writable=e,this.options=Ot.fromOptions(r),this.errorCount=0,this.writeSemaphore=new qn.Semaphore(1),this.writable.onError(i=>this.fireError(i)),this.writable.onClose(()=>this.fireClose())}async write(e){return this.writeSemaphore.lock(async()=>this.options.contentTypeEncoder.encode(e,this.options).then(i=>this.options.contentEncoder!==void 0?this.options.contentEncoder.encode(i):i).then(i=>{let a=[];return a.push(jn,i.byteLength.toString(),gr),a.push(gr),this.doWrite(e,a,i)},i=>{throw this.fireError(i),i}))}async doWrite(e,r,i){try{return await this.writable.write(r.join(""),"ascii"),this.writable.write(i)}catch(a){return this.handleError(a,e),Promise.reject(a)}}handleError(e,r){this.errorCount++,this.fireError(e,r,this.errorCount)}end(){this.writable.end()}};W.WriteableStreamMessageWriter=xt});var br=x(H=>{"use strict";Object.defineProperty(H,"__esModule",{value:!0});H.LRUCache=H.LinkedMap=H.Touch=void 0;var j;(function(t){t.None=0,t.First=1,t.AsOld=t.First,t.Last=2,t.AsNew=t.Last})(j=H.Touch||(H.Touch={}));var $e=class{constructor(){this[Symbol.toStringTag]="LinkedMap",this._map=new Map,this._head=void 0,this._tail=void 0,this._size=0,this._state=0}clear(){this._map.clear(),this._head=void 0,this._tail=void 0,this._size=0,this._state++}isEmpty(){return!this._head&&!this._tail}get size(){return this._size}get first(){var e;return(e=this._head)===null||e===void 0?void 0:e.value}get last(){var e;return(e=this._tail)===null||e===void 0?void 0:e.value}has(e){return this._map.has(e)}get(e,r=j.None){let i=this._map.get(e);if(!!i)return r!==j.None&&this.touch(i,r),i.value}set(e,r,i=j.None){let a=this._map.get(e);if(a)a.value=r,i!==j.None&&this.touch(a,i);else{switch(a={key:e,value:r,next:void 0,previous:void 0},i){case j.None:this.addItemLast(a);break;case j.First:this.addItemFirst(a);break;case j.Last:this.addItemLast(a);break;default:this.addItemLast(a);break}this._map.set(e,a),this._size++}return this}delete(e){return!!this.remove(e)}remove(e){let r=this._map.get(e);if(!!r)return this._map.delete(e),this.removeItem(r),this._size--,r.value}shift(){if(!this._head&&!this._tail)return;if(!this._head||!this._tail)throw new Error("Invalid list");let e=this._head;return this._map.delete(e.key),this.removeItem(e),this._size--,e.value}forEach(e,r){let i=this._state,a=this._head;for(;a;){if(r?e.bind(r)(a.value,a.key,this):e(a.value,a.key,this),this._state!==i)throw new Error("LinkedMap got modified during iteration.");a=a.next}}keys(){let e=this,r=this._state,i=this._head,a={[Symbol.iterator](){return a},next(){if(e._state!==r)throw new Error("LinkedMap got modified during iteration.");if(i){let h={value:i.key,done:!1};return i=i.next,h}else return{value:void 0,done:!0}}};return a}values(){let e=this,r=this._state,i=this._head,a={[Symbol.iterator](){return a},next(){if(e._state!==r)throw new Error("LinkedMap got modified during iteration.");if(i){let h={value:i.value,done:!1};return i=i.next,h}else return{value:void 0,done:!0}}};return a}entries(){let e=this,r=this._state,i=this._head,a={[Symbol.iterator](){return a},next(){if(e._state!==r)throw new Error("LinkedMap got modified during iteration.");if(i){let h={value:[i.key,i.value],done:!1};return i=i.next,h}else return{value:void 0,done:!0}}};return a}[Symbol.iterator](){return this.entries()}trimOld(e){if(e>=this.size)return;if(e===0){this.clear();return}let r=this._head,i=this.size;for(;r&&i>e;)this._map.delete(r.key),r=r.next,i--;this._head=r,this._size=i,r&&(r.previous=void 0),this._state++}addItemFirst(e){if(!this._head&&!this._tail)this._tail=e;else if(this._head)e.next=this._head,this._head.previous=e;else throw new Error("Invalid list");this._head=e,this._state++}addItemLast(e){if(!this._head&&!this._tail)this._head=e;else if(this._tail)e.previous=this._tail,this._tail.next=e;else throw new Error("Invalid list");this._tail=e,this._state++}removeItem(e){if(e===this._head&&e===this._tail)this._head=void 0,this._tail=void 0;else if(e===this._head){if(!e.next)throw new Error("Invalid list");e.next.previous=void 0,this._head=e.next}else if(e===this._tail){if(!e.previous)throw new Error("Invalid list");e.previous.next=void 0,this._tail=e.previous}else{let r=e.next,i=e.previous;if(!r||!i)throw new Error("Invalid list");r.previous=i,i.next=r}e.next=void 0,e.previous=void 0,this._state++}touch(e,r){if(!this._head||!this._tail)throw new Error("Invalid list");if(!(r!==j.First&&r!==j.Last)){if(r===j.First){if(e===this._head)return;let i=e.next,a=e.previous;e===this._tail?(a.next=void 0,this._tail=a):(i.previous=a,a.next=i),e.previous=void 0,e.next=this._head,this._head.previous=e,this._head=e,this._state++}else if(r===j.Last){if(e===this._tail)return;let i=e.next,a=e.previous;e===this._head?(i.previous=void 0,this._head=i):(i.previous=a,a.next=i),e.next=void 0,e.previous=this._tail,this._tail.next=e,this._tail=e,this._state++}}}toJSON(){let e=[];return this.forEach((r,i)=>{e.push([i,r])}),e}fromJSON(e){this.clear();for(let[r,i]of e)this.set(r,i)}};H.LinkedMap=$e;var Mt=class extends $e{constructor(e,r=1){super(),this._limit=e,this._ratio=Math.min(Math.max(0,r),1)}get limit(){return this._limit}set limit(e){this._limit=e,this.checkTrim()}get ratio(){return this._ratio}set ratio(e){this._ratio=Math.min(Math.max(0,e),1),this.checkTrim()}get(e,r=j.AsNew){return super.get(e,r)}peek(e){return super.get(e,j.None)}set(e,r){return super.set(e,r,j.Last),this.checkTrim(),this}checkTrim(){this.size>this._limit&&this.trimOld(Math.round(this._limit*this._ratio))}};H.LRUCache=Mt});var Rr=x(f=>{"use strict";Object.defineProperty(f,"__esModule",{value:!0});f.createMessageConnection=f.ConnectionOptions=f.CancellationStrategy=f.CancellationSenderStrategy=f.CancellationReceiverStrategy=f.ConnectionStrategy=f.ConnectionError=f.ConnectionErrors=f.LogTraceNotification=f.SetTraceNotification=f.TraceFormat=f.Trace=f.NullLogger=f.ProgressType=void 0;var _r=F(),P=he(),d=wt(),vr=br(),we=ne(),qt=St(),Ee;(function(t){t.type=new d.NotificationType("$/cancelRequest")})(Ee||(Ee={}));var Ae;(function(t){t.type=new d.NotificationType("$/progress")})(Ae||(Ae={}));var jt=class{constructor(){}};f.ProgressType=jt;var Lt;(function(t){function e(r){return P.func(r)}t.is=e})(Lt||(Lt={}));f.NullLogger=Object.freeze({error:()=>{},warn:()=>{},info:()=>{},log:()=>{}});var R;(function(t){t[t.Off=0]="Off",t[t.Messages=1]="Messages",t[t.Verbose=2]="Verbose"})(R=f.Trace||(f.Trace={}));(function(t){function e(i){if(!P.string(i))return t.Off;switch(i=i.toLowerCase(),i){case"off":return t.Off;case"messages":return t.Messages;case"verbose":return t.Verbose;default:return t.Off}}t.fromString=e;function r(i){switch(i){case t.Off:return"off";case t.Messages:return"messages";case t.Verbose:return"verbose";default:return"off"}}t.toString=r})(R=f.Trace||(f.Trace={}));var z;(function(t){t.Text="text",t.JSON="json"})(z=f.TraceFormat||(f.TraceFormat={}));(function(t){function e(r){return r=r.toLowerCase(),r==="json"?t.JSON:t.Text}t.fromString=e})(z=f.TraceFormat||(f.TraceFormat={}));var wr;(function(t){t.type=new d.NotificationType("$/setTrace")})(wr=f.SetTraceNotification||(f.SetTraceNotification={}));var Dt;(function(t){t.type=new d.NotificationType("$/logTrace")})(Dt=f.LogTraceNotification||(f.LogTraceNotification={}));var Ie;(function(t){t[t.Closed=1]="Closed",t[t.Disposed=2]="Disposed",t[t.AlreadyListening=3]="AlreadyListening"})(Ie=f.ConnectionErrors||(f.ConnectionErrors={}));var K=class extends Error{constructor(e,r){super(r),this.code=e,Object.setPrototypeOf(this,K.prototype)}};f.ConnectionError=K;var Er;(function(t){function e(r){let i=r;return i&&P.func(i.cancelUndispatched)}t.is=e})(Er=f.ConnectionStrategy||(f.ConnectionStrategy={}));var $t;(function(t){t.Message=Object.freeze({createCancellationTokenSource(r){return new qt.CancellationTokenSource}});function e(r){let i=r;return i&&P.func(i.createCancellationTokenSource)}t.is=e})($t=f.CancellationReceiverStrategy||(f.CancellationReceiverStrategy={}));var It;(function(t){t.Message=Object.freeze({sendCancellation(r,i){r.sendNotification(Ee.type,{id:i})},cleanup(r){}});function e(r){let i=r;return i&&P.func(i.sendCancellation)&&P.func(i.cleanup)}t.is=e})(It=f.CancellationSenderStrategy||(f.CancellationSenderStrategy={}));var At;(function(t){t.Message=Object.freeze({receiver:$t.Message,sender:It.Message});function e(r){let i=r;return i&&$t.is(i.receiver)&&It.is(i.sender)}t.is=e})(At=f.CancellationStrategy||(f.CancellationStrategy={}));var Dn;(function(t){function e(r){let i=r;return i&&(At.is(i.cancellationStrategy)||Er.is(i.connectionStrategy))}t.is=e})(Dn=f.ConnectionOptions||(f.ConnectionOptions={}));var J;(function(t){t[t.New=1]="New",t[t.Listening=2]="Listening",t[t.Closed=3]="Closed",t[t.Disposed=4]="Disposed"})(J||(J={}));function $n(t,e,r,i){let a=r!==void 0?r:f.NullLogger,h=0,E=0,L=0,_="2.0",q,D=Object.create(null),X,oe=Object.create(null),ke=new Map,ze,Y=new vr.LinkedMap,Z=Object.create(null),U=Object.create(null),O=R.Off,ee=z.Text,T,V=J.New,Je=new we.Emitter,Ut=new we.Emitter,Vt=new we.Emitter,Qt=new we.Emitter,Kt=new we.Emitter,Ce=i&&i.cancellationStrategy?i.cancellationStrategy:At.Message;function Gt(n){if(n===null)throw new Error("Can't send requests with id null since the response can't be correlated.");return"req-"+n.toString()}function Ar(n){return n===null?"res-unknown-"+(++L).toString():"res-"+n.toString()}function zr(){return"not-"+(++E).toString()}function Jr(n,s){d.isRequestMessage(s)?n.set(Gt(s.id),s):d.isResponseMessage(s)?n.set(Ar(s.id),s):n.set(zr(),s)}function Fr(n){}function Xt(){return V===J.Listening}function Yt(){return V===J.Closed}function ae(){return V===J.Disposed}function Zt(){(V===J.New||V===J.Listening)&&(V=J.Closed,Ut.fire(void 0))}function Br(n){Je.fire([n,void 0,void 0])}function Wr(n){Je.fire(n)}t.onClose(Zt),t.onError(Br),e.onClose(Zt),e.onError(Wr);function er(){ze||Y.size===0||(ze=_r.default().timer.setImmediate(()=>{ze=void 0,Hr()}))}function Hr(){if(Y.size===0)return;let n=Y.shift();try{d.isRequestMessage(n)?Vr(n):d.isNotificationMessage(n)?Kr(n):d.isResponseMessage(n)?Qr(n):Gr(n)}finally{er()}}let Ur=n=>{try{if(d.isNotificationMessage(n)&&n.method===Ee.type.method){let s=Gt(n.params.id),c=Y.get(s);if(d.isRequestMessage(c)){let l=i?.connectionStrategy,p=l&&l.cancelUndispatched?l.cancelUndispatched(c,Fr):void 0;if(p&&(p.error!==void 0||p.result!==void 0)){Y.delete(s),p.id=c.id,Pe(p,n.method,Date.now()),e.write(p);return}}}Jr(Y,n)}finally{er()}};function Vr(n){if(ae())return;function s(m,w,g){let N={jsonrpc:_,id:n.id};m instanceof d.ResponseError?N.error=m.toJson():N.result=m===void 0?null:m,Pe(N,w,g),e.write(N)}function c(m,w,g){let N={jsonrpc:_,id:n.id,error:m.toJson()};Pe(N,w,g),e.write(N)}function l(m,w,g){m===void 0&&(m=null);let N={jsonrpc:_,id:n.id,result:m};Pe(N,w,g),e.write(N)}Zr(n);let p=D[n.method],v,S;p&&(v=p.type,S=p.handler);let k=Date.now();if(S||q){let m=String(n.id),w=Ce.receiver.createCancellationTokenSource(m);U[m]=w;try{let g;if(S)if(n.params===void 0){if(v!==void 0&&v.numberOfParams!==0){c(new d.ResponseError(d.ErrorCodes.InvalidParams,`Request ${n.method} defines ${v.numberOfParams} params but recevied none.`),n.method,k);return}g=S(w.token)}else if(Array.isArray(n.params)){if(v!==void 0&&v.parameterStructures===d.ParameterStructures.byName){c(new d.ResponseError(d.ErrorCodes.InvalidParams,`Request ${n.method} defines parameters by name but received parameters by position`),n.method,k);return}g=S(...n.params,w.token)}else{if(v!==void 0&&v.parameterStructures===d.ParameterStructures.byPosition){c(new d.ResponseError(d.ErrorCodes.InvalidParams,`Request ${n.method} defines parameters by position but received parameters by name`),n.method,k);return}g=S(n.params,w.token)}else q&&(g=q(n.method,n.params,w.token));let N=g;g?N.then?N.then($=>{delete U[m],s($,n.method,k)},$=>{delete U[m],$ instanceof d.ResponseError?c($,n.method,k):$&&P.string($.message)?c(new d.ResponseError(d.ErrorCodes.InternalError,`Request ${n.method} failed with message: ${$.message}`),n.method,k):c(new d.ResponseError(d.ErrorCodes.InternalError,`Request ${n.method} failed unexpectedly without providing any details.`),n.method,k)}):(delete U[m],s(g,n.method,k)):(delete U[m],l(g,n.method,k))}catch(g){delete U[m],g instanceof d.ResponseError?s(g,n.method,k):g&&P.string(g.message)?c(new d.ResponseError(d.ErrorCodes.InternalError,`Request ${n.method} failed with message: ${g.message}`),n.method,k):c(new d.ResponseError(d.ErrorCodes.InternalError,`Request ${n.method} failed unexpectedly without providing any details.`),n.method,k)}}else c(new d.ResponseError(d.ErrorCodes.MethodNotFound,`Unhandled method ${n.method}`),n.method,k)}function Qr(n){if(!ae())if(n.id===null)n.error?a.error(`Received response message without id: Error is: 
${JSON.stringify(n.error,void 0,4)}`):a.error("Received response message without id. No further error information provided.");else{let s=String(n.id),c=Z[s];if(tn(n,c),c){delete Z[s];try{if(n.error){let l=n.error;c.reject(new d.ResponseError(l.code,l.message,l.data))}else if(n.result!==void 0)c.resolve(n.result);else throw new Error("Should never happen.")}catch(l){l.message?a.error(`Response handler '${c.method}' failed with message: ${l.message}`):a.error(`Response handler '${c.method}' failed unexpectedly.`)}}}}function Kr(n){if(ae())return;let s,c;if(n.method===Ee.type.method)c=l=>{let p=l.id,v=U[String(p)];v&&v.cancel()};else{let l=oe[n.method];l&&(c=l.handler,s=l.type)}if(c||X)try{en(n),c?n.params===void 0?(s!==void 0&&s.numberOfParams!==0&&s.parameterStructures!==d.ParameterStructures.byName&&a.error(`Notification ${n.method} defines ${s.numberOfParams} params but recevied none.`),c()):Array.isArray(n.params)?(s!==void 0&&(s.parameterStructures===d.ParameterStructures.byName&&a.error(`Notification ${n.method} defines parameters by name but received parameters by position`),s.numberOfParams!==n.params.length&&a.error(`Notification ${n.method} defines ${s.numberOfParams} params but received ${n.params.length} argumennts`)),c(...n.params)):(s!==void 0&&s.parameterStructures===d.ParameterStructures.byPosition&&a.error(`Notification ${n.method} defines parameters by position but received parameters by name`),c(n.params)):X&&X(n.method,n.params)}catch(l){l.message?a.error(`Notification handler '${n.method}' failed with message: ${l.message}`):a.error(`Notification handler '${n.method}' failed unexpectedly.`)}else Vt.fire(n)}function Gr(n){if(!n){a.error("Received empty message.");return}a.error(`Received message which is neither a response nor a notification message:
${JSON.stringify(n,null,4)}`);let s=n;if(P.string(s.id)||P.number(s.id)){let c=String(s.id),l=Z[c];l&&l.reject(new Error("The received response has neither a result nor an error property."))}}function Xr(n){if(!(O===R.Off||!T))if(ee===z.Text){let s;O===R.Verbose&&n.params&&(s=`Params: ${JSON.stringify(n.params,null,4)}

`),T.log(`Sending request '${n.method} - (${n.id})'.`,s)}else ce("send-request",n)}function Yr(n){if(!(O===R.Off||!T))if(ee===z.Text){let s;O===R.Verbose&&(n.params?s=`Params: ${JSON.stringify(n.params,null,4)}

`:s=`No parameters provided.

`),T.log(`Sending notification '${n.method}'.`,s)}else ce("send-notification",n)}function Pe(n,s,c){if(!(O===R.Off||!T))if(ee===z.Text){let l;O===R.Verbose&&(n.error&&n.error.data?l=`Error data: ${JSON.stringify(n.error.data,null,4)}

`:n.result?l=`Result: ${JSON.stringify(n.result,null,4)}

`:n.error===void 0&&(l=`No result returned.

`)),T.log(`Sending response '${s} - (${n.id})'. Processing request took ${Date.now()-c}ms`,l)}else ce("send-response",n)}function Zr(n){if(!(O===R.Off||!T))if(ee===z.Text){let s;O===R.Verbose&&n.params&&(s=`Params: ${JSON.stringify(n.params,null,4)}

`),T.log(`Received request '${n.method} - (${n.id})'.`,s)}else ce("receive-request",n)}function en(n){if(!(O===R.Off||!T||n.method===Dt.type.method))if(ee===z.Text){let s;O===R.Verbose&&(n.params?s=`Params: ${JSON.stringify(n.params,null,4)}

`:s=`No parameters provided.

`),T.log(`Received notification '${n.method}'.`,s)}else ce("receive-notification",n)}function tn(n,s){if(!(O===R.Off||!T))if(ee===z.Text){let c;if(O===R.Verbose&&(n.error&&n.error.data?c=`Error data: ${JSON.stringify(n.error.data,null,4)}

`:n.result?c=`Result: ${JSON.stringify(n.result,null,4)}

`:n.error===void 0&&(c=`No result returned.

`)),s){let l=n.error?` Request failed: ${n.error.message} (${n.error.code}).`:"";T.log(`Received response '${s.method} - (${n.id})' in ${Date.now()-s.timerStart}ms.${l}`,c)}else T.log(`Received response ${n.id} without active response promise.`,c)}else ce("receive-response",n)}function ce(n,s){if(!T||O===R.Off)return;let c={isLSPMessage:!0,type:n,message:s,timestamp:Date.now()};T.log(c)}function ge(){if(Yt())throw new K(Ie.Closed,"Connection is closed.");if(ae())throw new K(Ie.Disposed,"Connection is disposed.")}function rn(){if(Xt())throw new K(Ie.AlreadyListening,"Connection is already listening")}function nn(){if(!Xt())throw new Error("Call listen() first.")}function ye(n){return n===void 0?null:n}function tr(n){if(n!==null)return n}function rr(n){return n!=null&&!Array.isArray(n)&&typeof n=="object"}function Fe(n,s){switch(n){case d.ParameterStructures.auto:return rr(s)?tr(s):[ye(s)];case d.ParameterStructures.byName:if(!rr(s))throw new Error("Recevied parameters by name but param is not an object literal.");return tr(s);case d.ParameterStructures.byPosition:return[ye(s)];default:throw new Error(`Unknown parameter structure ${n.toString()}`)}}function nr(n,s){let c,l=n.numberOfParams;switch(l){case 0:c=void 0;break;case 1:c=Fe(n.parameterStructures,s[0]);break;default:c=[];for(let p=0;p<s.length&&p<l;p++)c.push(ye(s[p]));if(s.length<l)for(let p=s.length;p<l;p++)c.push(null);break}return c}let ue={sendNotification:(n,...s)=>{ge();let c,l;if(P.string(n)){c=n;let v=s[0],S=0,k=d.ParameterStructures.auto;d.ParameterStructures.is(v)&&(S=1,k=v);let m=s.length,w=m-S;switch(w){case 0:l=void 0;break;case 1:l=Fe(k,s[S]);break;default:if(k===d.ParameterStructures.byName)throw new Error(`Recevied ${w} parameters for 'by Name' notification parameter structure.`);l=s.slice(S,m).map(g=>ye(g));break}}else{let v=s;c=n.method,l=nr(n,v)}let p={jsonrpc:_,method:c,params:l};Yr(p),e.write(p)},onNotification:(n,s)=>{ge();let c;return P.func(n)?X=n:s&&(P.string(n)?(c=n,oe[n]={type:void 0,handler:s}):(c=n.method,oe[n.method]={type:n,handler:s})),{dispose:()=>{c!==void 0?delete oe[c]:X=void 0}}},onProgress:(n,s,c)=>{if(ke.has(s))throw new Error(`Progress handler for token ${s} already registered`);return ke.set(s,c),{dispose:()=>{ke.delete(s)}}},sendProgress:(n,s,c)=>{ue.sendNotification(Ae.type,{token:s,value:c})},onUnhandledProgress:Qt.event,sendRequest:(n,...s)=>{ge(),nn();let c,l,p;if(P.string(n)){c=n;let m=s[0],w=s[s.length-1],g=0,N=d.ParameterStructures.auto;d.ParameterStructures.is(m)&&(g=1,N=m);let $=s.length;qt.CancellationToken.is(w)&&($=$-1,p=w);let te=$-g;switch(te){case 0:l=void 0;break;case 1:l=Fe(N,s[g]);break;default:if(N===d.ParameterStructures.byName)throw new Error(`Recevied ${te} parameters for 'by Name' request parameter structure.`);l=s.slice(g,$).map(Q=>ye(Q));break}}else{let m=s;c=n.method,l=nr(n,m);let w=n.numberOfParams;p=qt.CancellationToken.is(m[w])?m[w]:void 0}let v=h++,S;return p&&(S=p.onCancellationRequested(()=>{Ce.sender.sendCancellation(ue,v)})),new Promise((m,w)=>{let g={jsonrpc:_,id:v,method:c,params:l},N=Q=>{m(Q),Ce.sender.cleanup(v),S?.dispose()},$=Q=>{w(Q),Ce.sender.cleanup(v),S?.dispose()},te={method:c,timerStart:Date.now(),resolve:N,reject:$};Xr(g);try{e.write(g)}catch(Q){te.reject(new d.ResponseError(d.ErrorCodes.MessageWriteError,Q.message?Q.message:"Unknown reason")),te=null}te&&(Z[String(v)]=te)})},onRequest:(n,s)=>{ge();let c=null;return Lt.is(n)?(c=void 0,q=n):P.string(n)?(c=null,s!==void 0&&(c=n,D[n]={handler:s,type:void 0})):s!==void 0&&(c=n.method,D[n.method]={type:n,handler:s}),{dispose:()=>{c!==null&&(c!==void 0?delete D[c]:q=void 0)}}},trace:(n,s,c)=>{let l=!1,p=z.Text;c!==void 0&&(P.boolean(c)?l=c:(l=c.sendNotification||!1,p=c.traceFormat||z.Text)),O=n,ee=p,O===R.Off?T=void 0:T=s,l&&!Yt()&&!ae()&&ue.sendNotification(wr.type,{value:R.toString(n)})},onError:Je.event,onClose:Ut.event,onUnhandledNotification:Vt.event,onDispose:Kt.event,end:()=>{e.end()},dispose:()=>{if(ae())return;V=J.Disposed,Kt.fire(void 0);let n=new Error("Connection got disposed.");Object.keys(Z).forEach(s=>{Z[s].reject(n)}),Z=Object.create(null),U=Object.create(null),Y=new vr.LinkedMap,P.func(e.dispose)&&e.dispose(),P.func(t.dispose)&&t.dispose()},listen:()=>{ge(),rn(),V=J.Listening,t.listen(Ur)},inspect:()=>{_r.default().console.log("inspect")}};return ue.onNotification(Dt.type,n=>{O===R.Off||!T||T.log(n.message,O===R.Verbose?n.verbose:void 0)}),ue.onNotification(Ae.type,n=>{let s=ke.get(n.token);s?s(n.value):Qt.fire(n)}),ue}f.createMessageConnection=$n});var Ft=x(o=>{"use strict";Object.defineProperty(o,"__esModule",{value:!0});o.CancellationSenderStrategy=o.CancellationReceiverStrategy=o.ConnectionError=o.ConnectionErrors=o.LogTraceNotification=o.SetTraceNotification=o.TraceFormat=o.Trace=o.ProgressType=o.createMessageConnection=o.NullLogger=o.ConnectionOptions=o.ConnectionStrategy=o.WriteableStreamMessageWriter=o.AbstractMessageWriter=o.MessageWriter=o.ReadableStreamMessageReader=o.AbstractMessageReader=o.MessageReader=o.CancellationToken=o.CancellationTokenSource=o.Emitter=o.Event=o.Disposable=o.ParameterStructures=o.NotificationType9=o.NotificationType8=o.NotificationType7=o.NotificationType6=o.NotificationType5=o.NotificationType4=o.NotificationType3=o.NotificationType2=o.NotificationType1=o.NotificationType0=o.NotificationType=o.ErrorCodes=o.ResponseError=o.RequestType9=o.RequestType8=o.RequestType7=o.RequestType6=o.RequestType5=o.RequestType4=o.RequestType3=o.RequestType2=o.RequestType1=o.RequestType0=o.RequestType=o.RAL=void 0;o.CancellationStrategy=void 0;var b=wt();Object.defineProperty(o,"RequestType",{enumerable:!0,get:function(){return b.RequestType}});Object.defineProperty(o,"RequestType0",{enumerable:!0,get:function(){return b.RequestType0}});Object.defineProperty(o,"RequestType1",{enumerable:!0,get:function(){return b.RequestType1}});Object.defineProperty(o,"RequestType2",{enumerable:!0,get:function(){return b.RequestType2}});Object.defineProperty(o,"RequestType3",{enumerable:!0,get:function(){return b.RequestType3}});Object.defineProperty(o,"RequestType4",{enumerable:!0,get:function(){return b.RequestType4}});Object.defineProperty(o,"RequestType5",{enumerable:!0,get:function(){return b.RequestType5}});Object.defineProperty(o,"RequestType6",{enumerable:!0,get:function(){return b.RequestType6}});Object.defineProperty(o,"RequestType7",{enumerable:!0,get:function(){return b.RequestType7}});Object.defineProperty(o,"RequestType8",{enumerable:!0,get:function(){return b.RequestType8}});Object.defineProperty(o,"RequestType9",{enumerable:!0,get:function(){return b.RequestType9}});Object.defineProperty(o,"ResponseError",{enumerable:!0,get:function(){return b.ResponseError}});Object.defineProperty(o,"ErrorCodes",{enumerable:!0,get:function(){return b.ErrorCodes}});Object.defineProperty(o,"NotificationType",{enumerable:!0,get:function(){return b.NotificationType}});Object.defineProperty(o,"NotificationType0",{enumerable:!0,get:function(){return b.NotificationType0}});Object.defineProperty(o,"NotificationType1",{enumerable:!0,get:function(){return b.NotificationType1}});Object.defineProperty(o,"NotificationType2",{enumerable:!0,get:function(){return b.NotificationType2}});Object.defineProperty(o,"NotificationType3",{enumerable:!0,get:function(){return b.NotificationType3}});Object.defineProperty(o,"NotificationType4",{enumerable:!0,get:function(){return b.NotificationType4}});Object.defineProperty(o,"NotificationType5",{enumerable:!0,get:function(){return b.NotificationType5}});Object.defineProperty(o,"NotificationType6",{enumerable:!0,get:function(){return b.NotificationType6}});Object.defineProperty(o,"NotificationType7",{enumerable:!0,get:function(){return b.NotificationType7}});Object.defineProperty(o,"NotificationType8",{enumerable:!0,get:function(){return b.NotificationType8}});Object.defineProperty(o,"NotificationType9",{enumerable:!0,get:function(){return b.NotificationType9}});Object.defineProperty(o,"ParameterStructures",{enumerable:!0,get:function(){return b.ParameterStructures}});var In=Ue();Object.defineProperty(o,"Disposable",{enumerable:!0,get:function(){return In.Disposable}});var Tr=ne();Object.defineProperty(o,"Event",{enumerable:!0,get:function(){return Tr.Event}});Object.defineProperty(o,"Emitter",{enumerable:!0,get:function(){return Tr.Emitter}});var Sr=St();Object.defineProperty(o,"CancellationTokenSource",{enumerable:!0,get:function(){return Sr.CancellationTokenSource}});Object.defineProperty(o,"CancellationToken",{enumerable:!0,get:function(){return Sr.CancellationToken}});var zt=fr();Object.defineProperty(o,"MessageReader",{enumerable:!0,get:function(){return zt.MessageReader}});Object.defineProperty(o,"AbstractMessageReader",{enumerable:!0,get:function(){return zt.AbstractMessageReader}});Object.defineProperty(o,"ReadableStreamMessageReader",{enumerable:!0,get:function(){return zt.ReadableStreamMessageReader}});var Jt=yr();Object.defineProperty(o,"MessageWriter",{enumerable:!0,get:function(){return Jt.MessageWriter}});Object.defineProperty(o,"AbstractMessageWriter",{enumerable:!0,get:function(){return Jt.AbstractMessageWriter}});Object.defineProperty(o,"WriteableStreamMessageWriter",{enumerable:!0,get:function(){return Jt.WriteableStreamMessageWriter}});var I=Rr();Object.defineProperty(o,"ConnectionStrategy",{enumerable:!0,get:function(){return I.ConnectionStrategy}});Object.defineProperty(o,"ConnectionOptions",{enumerable:!0,get:function(){return I.ConnectionOptions}});Object.defineProperty(o,"NullLogger",{enumerable:!0,get:function(){return I.NullLogger}});Object.defineProperty(o,"createMessageConnection",{enumerable:!0,get:function(){return I.createMessageConnection}});Object.defineProperty(o,"ProgressType",{enumerable:!0,get:function(){return I.ProgressType}});Object.defineProperty(o,"Trace",{enumerable:!0,get:function(){return I.Trace}});Object.defineProperty(o,"TraceFormat",{enumerable:!0,get:function(){return I.TraceFormat}});Object.defineProperty(o,"SetTraceNotification",{enumerable:!0,get:function(){return I.SetTraceNotification}});Object.defineProperty(o,"LogTraceNotification",{enumerable:!0,get:function(){return I.LogTraceNotification}});Object.defineProperty(o,"ConnectionErrors",{enumerable:!0,get:function(){return I.ConnectionErrors}});Object.defineProperty(o,"ConnectionError",{enumerable:!0,get:function(){return I.ConnectionError}});Object.defineProperty(o,"CancellationReceiverStrategy",{enumerable:!0,get:function(){return I.CancellationReceiverStrategy}});Object.defineProperty(o,"CancellationSenderStrategy",{enumerable:!0,get:function(){return I.CancellationSenderStrategy}});Object.defineProperty(o,"CancellationStrategy",{enumerable:!0,get:function(){return I.CancellationStrategy}});var An=F();o.RAL=An.default});var Nr=x(A=>{"use strict";var zn=A&&A.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r),Object.defineProperty(t,i,{enumerable:!0,get:function(){return e[r]}})}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),Jn=A&&A.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&zn(e,t,r)};Object.defineProperty(A,"__esModule",{value:!0});A.createMessageConnection=A.BrowserMessageWriter=A.BrowserMessageReader=void 0;var Fn=ar();Fn.default.install();var me=Ft();Jn(Ft(),A);var Bt=class extends me.AbstractMessageReader{constructor(e){super(),this._onData=new me.Emitter,this._messageListener=r=>{this._onData.fire(r.data)},e.addEventListener("error",r=>this.fireError(r)),e.onmessage=this._messageListener}listen(e){return this._onData.event(e)}};A.BrowserMessageReader=Bt;var Wt=class extends me.AbstractMessageWriter{constructor(e){super(),this.context=e,this.errorCount=0,e.addEventListener("error",r=>this.fireError(r))}write(e){try{return this.context.postMessage(e),Promise.resolve()}catch(r){return this.handleError(r,e),Promise.reject(r)}}handleError(e,r){this.errorCount++,this.fireError(e,r,this.errorCount)}end(){}};A.BrowserMessageWriter=Wt;function Bn(t,e,r,i){return r===void 0&&(r=me.NullLogger),me.ConnectionStrategy.is(i)&&(i={connectionStrategy:i}),me.createMessageConnection(t,e,r,i)}A.createMessageConnection=Bn});var Re=x((hi,kr)=>{"use strict";kr.exports=Nr()});var Ir=Oe(Re(),1);var Se=Oe(Re(),1),Wn=Object.freeze(function(t,e){let r=setTimeout(t.bind(e),0);return{dispose(){clearTimeout(r)}}}),Te=class{constructor(e){this._isCancellationRequested=e;this._isCanceled=!1}cancel(){this._isCanceled||(this._isCanceled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCanceled?!0:this._isCanceled=this._isCancellationRequested()}get onCancellationRequested(){return this._isCanceled?Wn:(this._emitter||(this._emitter=new Se.Emitter),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=void 0)}},Ht=class{constructor(e){this._isCancellationRequested=e}get token(){return this._token??(this._token=new Te(this._isCancellationRequested))}cancel(){this._token instanceof Te?this._token.cancel():this.token||(this._token=Se.CancellationToken.Cancelled)}dispose(){this._token instanceof Te?this._token.dispose():this.token||(this._token=Se.CancellationToken.None)}};function Cr(t){return{createCancellationTokenSource:e=>new Ht(()=>t(e))}}var Ne=Oe(Re(),1),Pr=new Ne.RequestType2("addNumbers"),Or=new Ne.RequestType2("addNumbersSlow"),xr=new Ne.RequestType1("hello");var G=Oe(Re(),1);function Un(t){if(t.isCancellationRequested)throw new G.ResponseError(-32800,"request cancelled")}function Mr(t,e){let r=G.createMessageConnection(new G.BrowserMessageReader(self),new G.BrowserMessageWriter(self),void 0,{cancellationStrategy:t});r.onRequest(Pr,(a,h)=>a+h);function i(a){return new Promise(h=>setTimeout(h,a))}r.onRequest(Or,async(a,h,E)=>{for(let L=0;L<20;L++)await i(100),Un(E);return a+h}),e?.(r),r.listen(),!1&&console.log("worker started")}var Vn="/@cancellation@/";function Lr(t){return`.${Vn}${t}`}function Dr(t){return!!(t&&typeof t.id=="string")}var qr;(e=>{function t(r){return r.data.type==="setCanceled"&&Dr(r.source)&&(typeof r.data.id=="number"||typeof r.data.id=="string")}e.is=t})(qr||(qr={}));var jr;(e=>{function t(r){return r.data.type==="deleteCanceled"&&Dr(r.source)&&(typeof r.data.id=="number"||typeof r.data.id=="string")}e.is=t})(jr||(jr={}));var Qn="/@rpc@/";function $r(){return`.${Qn}`}function Kn(t){let e=Lr(t),r=new XMLHttpRequest;return r.open("GET",e,!1),r.send(),r.status===200}function Gn(t){let e=new XMLHttpRequest;return e.open("POST",$r(),!1),e.send(JSON.stringify({method:"hello",params:t})),JSON.parse(e.responseText).result}Mr({receiver:Cr(Kn),sender:Ir.CancellationSenderStrategy.Message},t=>{t.onRequest(xr,Gn)});})();
//# sourceMappingURL=sw-worker.js.map
