(()=>{var tn=Object.create;var ir=Object.defineProperty;var rn=Object.getOwnPropertyDescriptor;var nn=Object.getOwnPropertyNames;var sn=Object.getPrototypeOf,on=Object.prototype.hasOwnProperty;var M=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var an=(t,e,r,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of nn(e))!on.call(t,s)&&s!==r&&ir(t,s,{get:()=>e[s],enumerable:!(i=rn(e,s))||i.enumerable});return t};var Be=(t,e,r)=>(r=t!=null?tn(sn(t)):{},an(e||!t||!t.__esModule?ir(r,"default",{value:t,enumerable:!0}):r,t));var F=M(He=>{"use strict";Object.defineProperty(He,"__esModule",{value:!0});var Fe;function Je(){if(Fe===void 0)throw new Error("No runtime abstraction layer installed");return Fe}(function(t){function e(r){if(r===void 0)throw new Error("No runtime abstraction layer provided");Fe=r}t.install=e})(Je||(Je={}));He.default=Je});var Ue=M(ve=>{"use strict";Object.defineProperty(ve,"__esModule",{value:!0});ve.Disposable=void 0;var cn;(function(t){function e(r){return{dispose:r}}t.create=e})(cn=ve.Disposable||(ve.Disposable={}))});var ie=M(ne=>{"use strict";Object.defineProperty(ne,"__esModule",{value:!0});ne.Emitter=ne.Event=void 0;var un=F(),ln;(function(t){let e={dispose(){}};t.None=function(){return e}})(ln=ne.Event||(ne.Event={}));var Ve=class{add(e,r=null,i){this._callbacks||(this._callbacks=[],this._contexts=[]),this._callbacks.push(e),this._contexts.push(r),Array.isArray(i)&&i.push({dispose:()=>this.remove(e,r)})}remove(e,r=null){if(!this._callbacks)return;let i=!1;for(let s=0,f=this._callbacks.length;s<f;s++)if(this._callbacks[s]===e)if(this._contexts[s]===r){this._callbacks.splice(s,1),this._contexts.splice(s,1);return}else i=!0;if(i)throw new Error("When adding a listener with a context, you should remove it with the same context")}invoke(...e){if(!this._callbacks)return[];let r=[],i=this._callbacks.slice(0),s=this._contexts.slice(0);for(let f=0,v=i.length;f<v;f++)try{r.push(i[f].apply(s[f],e))}catch(q){un.default().console.error(q)}return r}isEmpty(){return!this._callbacks||this._callbacks.length===0}dispose(){this._callbacks=void 0,this._contexts=void 0}},de=class{constructor(e){this._options=e}get event(){return this._event||(this._event=(e,r,i)=>{this._callbacks||(this._callbacks=new Ve),this._options&&this._options.onFirstListenerAdd&&this._callbacks.isEmpty()&&this._options.onFirstListenerAdd(this),this._callbacks.add(e,r);let s={dispose:()=>{!this._callbacks||(this._callbacks.remove(e,r),s.dispose=de._noop,this._options&&this._options.onLastListenerRemove&&this._callbacks.isEmpty()&&this._options.onLastListenerRemove(this))}};return Array.isArray(i)&&i.push(s),s}),this._event}fire(e){this._callbacks&&this._callbacks.invoke.call(this._callbacks,e)}dispose(){this._callbacks&&(this._callbacks.dispose(),this._callbacks=void 0)}};ne.Emitter=de;de._noop=function(){}});var sr=M(Ce=>{"use strict";Object.defineProperty(Ce,"__esModule",{value:!0});Ce.AbstractMessageBuffer=void 0;var dn=13,fn=10,hn=`\r
`,Qe=class{constructor(e="utf-8"){this._encoding=e,this._chunks=[],this._totalLength=0}get encoding(){return this._encoding}append(e){let r=typeof e=="string"?this.fromString(e,this._encoding):e;this._chunks.push(r),this._totalLength+=r.byteLength}tryReadHeaders(){if(this._chunks.length===0)return;let e=0,r=0,i=0,s=0;e:for(;r<this._chunks.length;){let _=this._chunks[r];i=0;t:for(;i<_.length;){switch(_[i]){case dn:switch(e){case 0:e=1;break;case 2:e=3;break;default:e=0}break;case fn:switch(e){case 1:e=2;break;case 3:e=4,i++;break e;default:e=0}break;default:e=0}i++}s+=_.byteLength,r++}if(e!==4)return;let f=this._read(s+i),v=new Map,q=this.toString(f,"ascii").split(hn);if(q.length<2)return v;for(let _=0;_<q.length-2;_++){let L=q[_],D=L.indexOf(":");if(D===-1)throw new Error("Message header must separate key and value using :");let Y=L.substr(0,D),ae=L.substr(D+1).trim();v.set(Y,ae)}return v}tryReadBody(e){if(!(this._totalLength<e))return this._read(e)}get numberOfBytes(){return this._totalLength}_read(e){if(e===0)return this.emptyBuffer();if(e>this._totalLength)throw new Error("Cannot read so many bytes!");if(this._chunks[0].byteLength===e){let f=this._chunks[0];return this._chunks.shift(),this._totalLength-=e,this.asNative(f)}if(this._chunks[0].byteLength>e){let f=this._chunks[0],v=this.asNative(f,e);return this._chunks[0]=f.slice(e),this._totalLength-=e,v}let r=this.allocNative(e),i=0,s=0;for(;e>0;){let f=this._chunks[s];if(f.byteLength>e){let v=f.slice(0,e);r.set(v,i),i+=e,this._chunks[s]=f.slice(e),this._totalLength-=e,e-=e}else r.set(f,i),i+=f.byteLength,this._chunks.shift(),this._totalLength-=f.byteLength,e-=f.byteLength}return r}};Ce.AbstractMessageBuffer=Qe});var ar=M(Ye=>{"use strict";Object.defineProperty(Ye,"__esModule",{value:!0});var pn=F(),fe=Ue(),mn=ie(),gn=sr(),he=class extends gn.AbstractMessageBuffer{constructor(e="utf-8"){super(e),this.asciiDecoder=new TextDecoder("ascii")}emptyBuffer(){return he.emptyBuffer}fromString(e,r){return new TextEncoder().encode(e)}toString(e,r){return r==="ascii"?this.asciiDecoder.decode(e):new TextDecoder(r).decode(e)}asNative(e,r){return r===void 0?e:e.slice(0,r)}allocNative(e){return new Uint8Array(e)}};he.emptyBuffer=new Uint8Array(0);var Ke=class{constructor(e){this.socket=e,this._onData=new mn.Emitter,this._messageListener=r=>{r.data.arrayBuffer().then(s=>{this._onData.fire(new Uint8Array(s))})},this.socket.addEventListener("message",this._messageListener)}onClose(e){return this.socket.addEventListener("close",e),fe.Disposable.create(()=>this.socket.removeEventListener("close",e))}onError(e){return this.socket.addEventListener("error",e),fe.Disposable.create(()=>this.socket.removeEventListener("error",e))}onEnd(e){return this.socket.addEventListener("end",e),fe.Disposable.create(()=>this.socket.removeEventListener("end",e))}onData(e){return this._onData.event(e)}},Xe=class{constructor(e){this.socket=e}onClose(e){return this.socket.addEventListener("close",e),fe.Disposable.create(()=>this.socket.removeEventListener("close",e))}onError(e){return this.socket.addEventListener("error",e),fe.Disposable.create(()=>this.socket.removeEventListener("error",e))}onEnd(e){return this.socket.addEventListener("end",e),fe.Disposable.create(()=>this.socket.removeEventListener("end",e))}write(e,r){if(typeof e=="string"){if(r!==void 0&&r!=="utf-8")throw new Error(`In a Browser environments only utf-8 text encding is supported. But got encoding: ${r}`);this.socket.send(e)}else this.socket.send(e);return Promise.resolve()}end(){this.socket.close()}},yn=new TextEncoder,or=Object.freeze({messageBuffer:Object.freeze({create:t=>new he(t)}),applicationJson:Object.freeze({encoder:Object.freeze({name:"application/json",encode:(t,e)=>{if(e.charset!=="utf-8")throw new Error(`In a Browser environments only utf-8 text encding is supported. But got encoding: ${e.charset}`);return Promise.resolve(yn.encode(JSON.stringify(t,void 0,0)))}}),decoder:Object.freeze({name:"application/json",decode:(t,e)=>{if(!(t instanceof Uint8Array))throw new Error("In a Browser environments only Uint8Arrays are supported.");return Promise.resolve(JSON.parse(new TextDecoder(e.charset).decode(t)))}})}),stream:Object.freeze({asReadableStream:t=>new Ke(t),asWritableStream:t=>new Xe(t)}),console,timer:Object.freeze({setTimeout(t,e,...r){return setTimeout(t,e,...r)},clearTimeout(t){clearTimeout(t)},setImmediate(t,...e){return setTimeout(t,0,...e)},clearImmediate(t){clearTimeout(t)}})});function Ge(){return or}(function(t){function e(){pn.default.install(or)}t.install=e})(Ge||(Ge={}));Ye.default=Ge});var pe=M(j=>{"use strict";Object.defineProperty(j,"__esModule",{value:!0});j.stringArray=j.array=j.func=j.error=j.number=j.string=j.boolean=void 0;function bn(t){return t===!0||t===!1}j.boolean=bn;function cr(t){return typeof t=="string"||t instanceof String}j.string=cr;function vn(t){return typeof t=="number"||t instanceof Number}j.number=vn;function _n(t){return t instanceof Error}j.error=_n;function wn(t){return typeof t=="function"}j.func=wn;function ur(t){return Array.isArray(t)}j.array=ur;function En(t){return ur(t)&&t.every(e=>cr(e))}j.stringArray=En});var wt=M(u=>{"use strict";Object.defineProperty(u,"__esModule",{value:!0});u.isResponseMessage=u.isNotificationMessage=u.isRequestMessage=u.NotificationType9=u.NotificationType8=u.NotificationType7=u.NotificationType6=u.NotificationType5=u.NotificationType4=u.NotificationType3=u.NotificationType2=u.NotificationType1=u.NotificationType0=u.NotificationType=u.RequestType9=u.RequestType8=u.RequestType7=u.RequestType6=u.RequestType5=u.RequestType4=u.RequestType3=u.RequestType2=u.RequestType1=u.RequestType=u.RequestType0=u.AbstractMessageSignature=u.ParameterStructures=u.ResponseError=u.ErrorCodes=void 0;var se=pe(),lr;(function(t){t.ParseError=-32700,t.InvalidRequest=-32600,t.MethodNotFound=-32601,t.InvalidParams=-32602,t.InternalError=-32603,t.jsonrpcReservedErrorRangeStart=-32099,t.serverErrorStart=t.jsonrpcReservedErrorRangeStart,t.MessageWriteError=-32099,t.MessageReadError=-32098,t.ServerNotInitialized=-32002,t.UnknownErrorCode=-32001,t.jsonrpcReservedErrorRangeEnd=-32e3,t.serverErrorEnd=t.jsonrpcReservedErrorRangeEnd})(lr=u.ErrorCodes||(u.ErrorCodes={}));var _e=class extends Error{constructor(e,r,i){super(r),this.code=se.number(e)?e:lr.UnknownErrorCode,this.data=i,Object.setPrototypeOf(this,_e.prototype)}toJson(){return{code:this.code,message:this.message,data:this.data}}};u.ResponseError=_e;var C=class{constructor(e){this.kind=e}static is(e){return e===C.auto||e===C.byName||e===C.byPosition}toString(){return this.kind}};u.ParameterStructures=C;C.auto=new C("auto");C.byPosition=new C("byPosition");C.byName=new C("byName");var y=class{constructor(e,r){this.method=e,this.numberOfParams=r}get parameterStructures(){return C.auto}};u.AbstractMessageSignature=y;var Ze=class extends y{constructor(e){super(e,0)}};u.RequestType0=Ze;var et=class extends y{constructor(e,r=C.auto){super(e,1),this._parameterStructures=r}get parameterStructures(){return this._parameterStructures}};u.RequestType=et;var tt=class extends y{constructor(e,r=C.auto){super(e,1),this._parameterStructures=r}get parameterStructures(){return this._parameterStructures}};u.RequestType1=tt;var rt=class extends y{constructor(e){super(e,2)}};u.RequestType2=rt;var nt=class extends y{constructor(e){super(e,3)}};u.RequestType3=nt;var it=class extends y{constructor(e){super(e,4)}};u.RequestType4=it;var st=class extends y{constructor(e){super(e,5)}};u.RequestType5=st;var ot=class extends y{constructor(e){super(e,6)}};u.RequestType6=ot;var at=class extends y{constructor(e){super(e,7)}};u.RequestType7=at;var ct=class extends y{constructor(e){super(e,8)}};u.RequestType8=ct;var ut=class extends y{constructor(e){super(e,9)}};u.RequestType9=ut;var lt=class extends y{constructor(e,r=C.auto){super(e,1),this._parameterStructures=r}get parameterStructures(){return this._parameterStructures}};u.NotificationType=lt;var dt=class extends y{constructor(e){super(e,0)}};u.NotificationType0=dt;var ft=class extends y{constructor(e,r=C.auto){super(e,1),this._parameterStructures=r}get parameterStructures(){return this._parameterStructures}};u.NotificationType1=ft;var ht=class extends y{constructor(e){super(e,2)}};u.NotificationType2=ht;var pt=class extends y{constructor(e){super(e,3)}};u.NotificationType3=pt;var mt=class extends y{constructor(e){super(e,4)}};u.NotificationType4=mt;var gt=class extends y{constructor(e){super(e,5)}};u.NotificationType5=gt;var yt=class extends y{constructor(e){super(e,6)}};u.NotificationType6=yt;var bt=class extends y{constructor(e){super(e,7)}};u.NotificationType7=bt;var vt=class extends y{constructor(e){super(e,8)}};u.NotificationType8=vt;var _t=class extends y{constructor(e){super(e,9)}};u.NotificationType9=_t;function Rn(t){let e=t;return e&&se.string(e.method)&&(se.string(e.id)||se.number(e.id))}u.isRequestMessage=Rn;function Tn(t){let e=t;return e&&se.string(e.method)&&t.id===void 0}u.isNotificationMessage=Tn;function Sn(t){let e=t;return e&&(e.result!==void 0||!!e.error)&&(se.string(e.id)||se.number(e.id)||e.id===null)}u.isResponseMessage=Sn});var St=M(oe=>{"use strict";Object.defineProperty(oe,"__esModule",{value:!0});oe.CancellationTokenSource=oe.CancellationToken=void 0;var dr=F(),Nn=pe(),Et=ie(),Rt;(function(t){t.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:Et.Event.None}),t.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:Et.Event.None});function e(r){let i=r;return i&&(i===t.None||i===t.Cancelled||Nn.boolean(i.isCancellationRequested)&&!!i.onCancellationRequested)}t.is=e})(Rt=oe.CancellationToken||(oe.CancellationToken={}));var kn=Object.freeze(function(t,e){let r=dr.default().timer.setTimeout(t.bind(e),0);return{dispose(){dr.default().timer.clearTimeout(r)}}}),Oe=class{constructor(){this._isCancelled=!1}cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?kn:(this._emitter||(this._emitter=new Et.Emitter),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=void 0)}},Tt=class{get token(){return this._token||(this._token=new Oe),this._token}cancel(){this._token?this._token.cancel():this._token=Rt.Cancelled}dispose(){this._token?this._token instanceof Oe&&this._token.dispose():this._token=Rt.None}};oe.CancellationTokenSource=Tt});var fr=M(J=>{"use strict";Object.defineProperty(J,"__esModule",{value:!0});J.ReadableStreamMessageReader=J.AbstractMessageReader=J.MessageReader=void 0;var xe=F(),me=pe(),Nt=ie(),Pn;(function(t){function e(r){let i=r;return i&&me.func(i.listen)&&me.func(i.dispose)&&me.func(i.onError)&&me.func(i.onClose)&&me.func(i.onPartialMessage)}t.is=e})(Pn=J.MessageReader||(J.MessageReader={}));var Me=class{constructor(){this.errorEmitter=new Nt.Emitter,this.closeEmitter=new Nt.Emitter,this.partialMessageEmitter=new Nt.Emitter}dispose(){this.errorEmitter.dispose(),this.closeEmitter.dispose()}get onError(){return this.errorEmitter.event}fireError(e){this.errorEmitter.fire(this.asError(e))}get onClose(){return this.closeEmitter.event}fireClose(){this.closeEmitter.fire(void 0)}get onPartialMessage(){return this.partialMessageEmitter.event}firePartialMessage(e){this.partialMessageEmitter.fire(e)}asError(e){return e instanceof Error?e:new Error(`Reader received error. Reason: ${me.string(e.message)?e.message:"unknown"}`)}};J.AbstractMessageReader=Me;var kt;(function(t){function e(r){var i;let s,f,v,q=new Map,_,L=new Map;if(r===void 0||typeof r=="string")s=r??"utf-8";else{if(s=(i=r.charset)!==null&&i!==void 0?i:"utf-8",r.contentDecoder!==void 0&&(v=r.contentDecoder,q.set(v.name,v)),r.contentDecoders!==void 0)for(let D of r.contentDecoders)q.set(D.name,D);if(r.contentTypeDecoder!==void 0&&(_=r.contentTypeDecoder,L.set(_.name,_)),r.contentTypeDecoders!==void 0)for(let D of r.contentTypeDecoders)L.set(D.name,D)}return _===void 0&&(_=xe.default().applicationJson.decoder,L.set(_.name,_)),{charset:s,contentDecoder:v,contentDecoders:q,contentTypeDecoder:_,contentTypeDecoders:L}}t.fromOptions=e})(kt||(kt={}));var Pt=class extends Me{constructor(e,r){super(),this.readable=e,this.options=kt.fromOptions(r),this.buffer=xe.default().messageBuffer.create(this.options.charset),this._partialMessageTimeout=1e4,this.nextMessageLength=-1,this.messageToken=0}set partialMessageTimeout(e){this._partialMessageTimeout=e}get partialMessageTimeout(){return this._partialMessageTimeout}listen(e){this.nextMessageLength=-1,this.messageToken=0,this.partialMessageTimer=void 0,this.callback=e;let r=this.readable.onData(i=>{this.onData(i)});return this.readable.onError(i=>this.fireError(i)),this.readable.onClose(()=>this.fireClose()),r}onData(e){for(this.buffer.append(e);;){if(this.nextMessageLength===-1){let s=this.buffer.tryReadHeaders();if(!s)return;let f=s.get("Content-Length");if(!f)throw new Error("Header must provide a Content-Length property.");let v=parseInt(f);if(isNaN(v))throw new Error("Content-Length value must be a number.");this.nextMessageLength=v}let r=this.buffer.tryReadBody(this.nextMessageLength);if(r===void 0){this.setPartialMessageTimer();return}this.clearPartialMessageTimer(),this.nextMessageLength=-1;let i;this.options.contentDecoder!==void 0?i=this.options.contentDecoder.decode(r):i=Promise.resolve(r),i.then(s=>{this.options.contentTypeDecoder.decode(s,this.options).then(f=>{this.callback(f)},f=>{this.fireError(f)})},s=>{this.fireError(s)})}}clearPartialMessageTimer(){this.partialMessageTimer&&(xe.default().timer.clearTimeout(this.partialMessageTimer),this.partialMessageTimer=void 0)}setPartialMessageTimer(){this.clearPartialMessageTimer(),!(this._partialMessageTimeout<=0)&&(this.partialMessageTimer=xe.default().timer.setTimeout((e,r)=>{this.partialMessageTimer=void 0,e===this.messageToken&&(this.firePartialMessage({messageToken:e,waitingTime:r}),this.setPartialMessageTimer())},this._partialMessageTimeout,this.messageToken,this._partialMessageTimeout))}};J.ReadableStreamMessageReader=Pt});var hr=M(je=>{"use strict";Object.defineProperty(je,"__esModule",{value:!0});je.Semaphore=void 0;var Cn=F(),Ct=class{constructor(e=1){if(e<=0)throw new Error("Capacity must be greater than 0");this._capacity=e,this._active=0,this._waiting=[]}lock(e){return new Promise((r,i)=>{this._waiting.push({thunk:e,resolve:r,reject:i}),this.runNext()})}get active(){return this._active}runNext(){this._waiting.length===0||this._active===this._capacity||Cn.default().timer.setImmediate(()=>this.doRunNext())}doRunNext(){if(this._waiting.length===0||this._active===this._capacity)return;let e=this._waiting.shift();if(this._active++,this._active>this._capacity)throw new Error("To many thunks active");try{let r=e.thunk();r instanceof Promise?r.then(i=>{this._active--,e.resolve(i),this.runNext()},i=>{this._active--,e.reject(i),this.runNext()}):(this._active--,e.resolve(r),this.runNext())}catch(r){this._active--,e.reject(r),this.runNext()}}};je.Semaphore=Ct});var yr=M(H=>{"use strict";Object.defineProperty(H,"__esModule",{value:!0});H.WriteableStreamMessageWriter=H.AbstractMessageWriter=H.MessageWriter=void 0;var pr=F(),we=pe(),On=hr(),mr=ie(),xn="Content-Length: ",gr=`\r
`,Mn;(function(t){function e(r){let i=r;return i&&we.func(i.dispose)&&we.func(i.onClose)&&we.func(i.onError)&&we.func(i.write)}t.is=e})(Mn=H.MessageWriter||(H.MessageWriter={}));var qe=class{constructor(){this.errorEmitter=new mr.Emitter,this.closeEmitter=new mr.Emitter}dispose(){this.errorEmitter.dispose(),this.closeEmitter.dispose()}get onError(){return this.errorEmitter.event}fireError(e,r,i){this.errorEmitter.fire([this.asError(e),r,i])}get onClose(){return this.closeEmitter.event}fireClose(){this.closeEmitter.fire(void 0)}asError(e){return e instanceof Error?e:new Error(`Writer received error. Reason: ${we.string(e.message)?e.message:"unknown"}`)}};H.AbstractMessageWriter=qe;var Ot;(function(t){function e(r){var i,s;return r===void 0||typeof r=="string"?{charset:r??"utf-8",contentTypeEncoder:pr.default().applicationJson.encoder}:{charset:(i=r.charset)!==null&&i!==void 0?i:"utf-8",contentEncoder:r.contentEncoder,contentTypeEncoder:(s=r.contentTypeEncoder)!==null&&s!==void 0?s:pr.default().applicationJson.encoder}}t.fromOptions=e})(Ot||(Ot={}));var xt=class extends qe{constructor(e,r){super(),this.writable=e,this.options=Ot.fromOptions(r),this.errorCount=0,this.writeSemaphore=new On.Semaphore(1),this.writable.onError(i=>this.fireError(i)),this.writable.onClose(()=>this.fireClose())}async write(e){return this.writeSemaphore.lock(async()=>this.options.contentTypeEncoder.encode(e,this.options).then(i=>this.options.contentEncoder!==void 0?this.options.contentEncoder.encode(i):i).then(i=>{let s=[];return s.push(xn,i.byteLength.toString(),gr),s.push(gr),this.doWrite(e,s,i)},i=>{throw this.fireError(i),i}))}async doWrite(e,r,i){try{return await this.writable.write(r.join(""),"ascii"),this.writable.write(i)}catch(s){return this.handleError(s,e),Promise.reject(s)}}handleError(e,r){this.errorCount++,this.fireError(e,r,this.errorCount)}end(){this.writable.end()}};H.WriteableStreamMessageWriter=xt});var br=M(U=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0});U.LRUCache=U.LinkedMap=U.Touch=void 0;var $;(function(t){t.None=0,t.First=1,t.AsOld=t.First,t.Last=2,t.AsNew=t.Last})($=U.Touch||(U.Touch={}));var Le=class{constructor(){this[Symbol.toStringTag]="LinkedMap",this._map=new Map,this._head=void 0,this._tail=void 0,this._size=0,this._state=0}clear(){this._map.clear(),this._head=void 0,this._tail=void 0,this._size=0,this._state++}isEmpty(){return!this._head&&!this._tail}get size(){return this._size}get first(){var e;return(e=this._head)===null||e===void 0?void 0:e.value}get last(){var e;return(e=this._tail)===null||e===void 0?void 0:e.value}has(e){return this._map.has(e)}get(e,r=$.None){let i=this._map.get(e);if(!!i)return r!==$.None&&this.touch(i,r),i.value}set(e,r,i=$.None){let s=this._map.get(e);if(s)s.value=r,i!==$.None&&this.touch(s,i);else{switch(s={key:e,value:r,next:void 0,previous:void 0},i){case $.None:this.addItemLast(s);break;case $.First:this.addItemFirst(s);break;case $.Last:this.addItemLast(s);break;default:this.addItemLast(s);break}this._map.set(e,s),this._size++}return this}delete(e){return!!this.remove(e)}remove(e){let r=this._map.get(e);if(!!r)return this._map.delete(e),this.removeItem(r),this._size--,r.value}shift(){if(!this._head&&!this._tail)return;if(!this._head||!this._tail)throw new Error("Invalid list");let e=this._head;return this._map.delete(e.key),this.removeItem(e),this._size--,e.value}forEach(e,r){let i=this._state,s=this._head;for(;s;){if(r?e.bind(r)(s.value,s.key,this):e(s.value,s.key,this),this._state!==i)throw new Error("LinkedMap got modified during iteration.");s=s.next}}keys(){let e=this,r=this._state,i=this._head,s={[Symbol.iterator](){return s},next(){if(e._state!==r)throw new Error("LinkedMap got modified during iteration.");if(i){let f={value:i.key,done:!1};return i=i.next,f}else return{value:void 0,done:!0}}};return s}values(){let e=this,r=this._state,i=this._head,s={[Symbol.iterator](){return s},next(){if(e._state!==r)throw new Error("LinkedMap got modified during iteration.");if(i){let f={value:i.value,done:!1};return i=i.next,f}else return{value:void 0,done:!0}}};return s}entries(){let e=this,r=this._state,i=this._head,s={[Symbol.iterator](){return s},next(){if(e._state!==r)throw new Error("LinkedMap got modified during iteration.");if(i){let f={value:[i.key,i.value],done:!1};return i=i.next,f}else return{value:void 0,done:!0}}};return s}[Symbol.iterator](){return this.entries()}trimOld(e){if(e>=this.size)return;if(e===0){this.clear();return}let r=this._head,i=this.size;for(;r&&i>e;)this._map.delete(r.key),r=r.next,i--;this._head=r,this._size=i,r&&(r.previous=void 0),this._state++}addItemFirst(e){if(!this._head&&!this._tail)this._tail=e;else if(this._head)e.next=this._head,this._head.previous=e;else throw new Error("Invalid list");this._head=e,this._state++}addItemLast(e){if(!this._head&&!this._tail)this._head=e;else if(this._tail)e.previous=this._tail,this._tail.next=e;else throw new Error("Invalid list");this._tail=e,this._state++}removeItem(e){if(e===this._head&&e===this._tail)this._head=void 0,this._tail=void 0;else if(e===this._head){if(!e.next)throw new Error("Invalid list");e.next.previous=void 0,this._head=e.next}else if(e===this._tail){if(!e.previous)throw new Error("Invalid list");e.previous.next=void 0,this._tail=e.previous}else{let r=e.next,i=e.previous;if(!r||!i)throw new Error("Invalid list");r.previous=i,i.next=r}e.next=void 0,e.previous=void 0,this._state++}touch(e,r){if(!this._head||!this._tail)throw new Error("Invalid list");if(!(r!==$.First&&r!==$.Last)){if(r===$.First){if(e===this._head)return;let i=e.next,s=e.previous;e===this._tail?(s.next=void 0,this._tail=s):(i.previous=s,s.next=i),e.previous=void 0,e.next=this._head,this._head.previous=e,this._head=e,this._state++}else if(r===$.Last){if(e===this._tail)return;let i=e.next,s=e.previous;e===this._head?(i.previous=void 0,this._head=i):(i.previous=s,s.next=i),e.next=void 0,e.previous=this._tail,this._tail.next=e,this._tail=e,this._state++}}}toJSON(){let e=[];return this.forEach((r,i)=>{e.push([i,r])}),e}fromJSON(e){this.clear();for(let[r,i]of e)this.set(r,i)}};U.LinkedMap=Le;var Mt=class extends Le{constructor(e,r=1){super(),this._limit=e,this._ratio=Math.min(Math.max(0,r),1)}get limit(){return this._limit}set limit(e){this._limit=e,this.checkTrim()}get ratio(){return this._ratio}set ratio(e){this._ratio=Math.min(Math.max(0,e),1),this.checkTrim()}get(e,r=$.AsNew){return super.get(e,r)}peek(e){return super.get(e,$.None)}set(e,r){return super.set(e,r,$.Last),this.checkTrim(),this}checkTrim(){this.size>this._limit&&this.trimOld(Math.round(this._limit*this._ratio))}};U.LRUCache=Mt});var Rr=M(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0});h.createMessageConnection=h.ConnectionOptions=h.CancellationStrategy=h.CancellationSenderStrategy=h.CancellationReceiverStrategy=h.ConnectionStrategy=h.ConnectionError=h.ConnectionErrors=h.LogTraceNotification=h.SetTraceNotification=h.TraceFormat=h.Trace=h.NullLogger=h.ProgressType=void 0;var vr=F(),O=pe(),d=wt(),_r=br(),Ee=ie(),jt=St(),Re;(function(t){t.type=new d.NotificationType("$/cancelRequest")})(Re||(Re={}));var De;(function(t){t.type=new d.NotificationType("$/progress")})(De||(De={}));var qt=class{constructor(){}};h.ProgressType=qt;var Lt;(function(t){function e(r){return O.func(r)}t.is=e})(Lt||(Lt={}));h.NullLogger=Object.freeze({error:()=>{},warn:()=>{},info:()=>{},log:()=>{}});var T;(function(t){t[t.Off=0]="Off",t[t.Messages=1]="Messages",t[t.Verbose=2]="Verbose"})(T=h.Trace||(h.Trace={}));(function(t){function e(i){if(!O.string(i))return t.Off;switch(i=i.toLowerCase(),i){case"off":return t.Off;case"messages":return t.Messages;case"verbose":return t.Verbose;default:return t.Off}}t.fromString=e;function r(i){switch(i){case t.Off:return"off";case t.Messages:return"messages";case t.Verbose:return"verbose";default:return"off"}}t.toString=r})(T=h.Trace||(h.Trace={}));var z;(function(t){t.Text="text",t.JSON="json"})(z=h.TraceFormat||(h.TraceFormat={}));(function(t){function e(r){return r=r.toLowerCase(),r==="json"?t.JSON:t.Text}t.fromString=e})(z=h.TraceFormat||(h.TraceFormat={}));var wr;(function(t){t.type=new d.NotificationType("$/setTrace")})(wr=h.SetTraceNotification||(h.SetTraceNotification={}));var $t;(function(t){t.type=new d.NotificationType("$/logTrace")})($t=h.LogTraceNotification||(h.LogTraceNotification={}));var $e;(function(t){t[t.Closed=1]="Closed",t[t.Disposed=2]="Disposed",t[t.AlreadyListening=3]="AlreadyListening"})($e=h.ConnectionErrors||(h.ConnectionErrors={}));var X=class extends Error{constructor(e,r){super(r),this.code=e,Object.setPrototypeOf(this,X.prototype)}};h.ConnectionError=X;var Er;(function(t){function e(r){let i=r;return i&&O.func(i.cancelUndispatched)}t.is=e})(Er=h.ConnectionStrategy||(h.ConnectionStrategy={}));var Dt;(function(t){t.Message=Object.freeze({createCancellationTokenSource(r){return new jt.CancellationTokenSource}});function e(r){let i=r;return i&&O.func(i.createCancellationTokenSource)}t.is=e})(Dt=h.CancellationReceiverStrategy||(h.CancellationReceiverStrategy={}));var It;(function(t){t.Message=Object.freeze({sendCancellation(r,i){r.sendNotification(Re.type,{id:i})},cleanup(r){}});function e(r){let i=r;return i&&O.func(i.sendCancellation)&&O.func(i.cleanup)}t.is=e})(It=h.CancellationSenderStrategy||(h.CancellationSenderStrategy={}));var At;(function(t){t.Message=Object.freeze({receiver:Dt.Message,sender:It.Message});function e(r){let i=r;return i&&Dt.is(i.receiver)&&It.is(i.sender)}t.is=e})(At=h.CancellationStrategy||(h.CancellationStrategy={}));var jn;(function(t){function e(r){let i=r;return i&&(At.is(i.cancellationStrategy)||Er.is(i.connectionStrategy))}t.is=e})(jn=h.ConnectionOptions||(h.ConnectionOptions={}));var B;(function(t){t[t.New=1]="New",t[t.Listening=2]="Listening",t[t.Closed=3]="Closed",t[t.Disposed=4]="Disposed"})(B||(B={}));function qn(t,e,r,i){let s=r!==void 0?r:h.NullLogger,f=0,v=0,q=0,_="2.0",L,D=Object.create(null),Y,ae=Object.create(null),Ne=new Map,Ae,Z=new _r.LinkedMap,ee=Object.create(null),V=Object.create(null),x=T.Off,te=z.Text,S,Q=B.New,We=new Ee.Emitter,Ut=new Ee.Emitter,Vt=new Ee.Emitter,Qt=new Ee.Emitter,Kt=new Ee.Emitter,ke=i&&i.cancellationStrategy?i.cancellationStrategy:At.Message;function Xt(n){if(n===null)throw new Error("Can't send requests with id null since the response can't be correlated.");return"req-"+n.toString()}function $r(n){return n===null?"res-unknown-"+(++q).toString():"res-"+n.toString()}function Dr(){return"not-"+(++v).toString()}function Ir(n,o){d.isRequestMessage(o)?n.set(Xt(o.id),o):d.isResponseMessage(o)?n.set($r(o.id),o):n.set(Dr(),o)}function Ar(n){}function Gt(){return Q===B.Listening}function Yt(){return Q===B.Closed}function ce(){return Q===B.Disposed}function Zt(){(Q===B.New||Q===B.Listening)&&(Q=B.Closed,Ut.fire(void 0))}function Wr(n){We.fire([n,void 0,void 0])}function zr(n){We.fire(n)}t.onClose(Zt),t.onError(Wr),e.onClose(Zt),e.onError(zr);function er(){Ae||Z.size===0||(Ae=vr.default().timer.setImmediate(()=>{Ae=void 0,Br()}))}function Br(){if(Z.size===0)return;let n=Z.shift();try{d.isRequestMessage(n)?Jr(n):d.isNotificationMessage(n)?Ur(n):d.isResponseMessage(n)?Hr(n):Vr(n)}finally{er()}}let Fr=n=>{try{if(d.isNotificationMessage(n)&&n.method===Re.type.method){let o=Xt(n.params.id),c=Z.get(o);if(d.isRequestMessage(c)){let l=i?.connectionStrategy,p=l&&l.cancelUndispatched?l.cancelUndispatched(c,Ar):void 0;if(p&&(p.error!==void 0||p.result!==void 0)){Z.delete(o),p.id=c.id,Pe(p,n.method,Date.now()),e.write(p);return}}}Ir(Z,n)}finally{er()}};function Jr(n){if(ce())return;function o(m,E,g){let k={jsonrpc:_,id:n.id};m instanceof d.ResponseError?k.error=m.toJson():k.result=m===void 0?null:m,Pe(k,E,g),e.write(k)}function c(m,E,g){let k={jsonrpc:_,id:n.id,error:m.toJson()};Pe(k,E,g),e.write(k)}function l(m,E,g){m===void 0&&(m=null);let k={jsonrpc:_,id:n.id,result:m};Pe(k,E,g),e.write(k)}Xr(n);let p=D[n.method],w,N;p&&(w=p.type,N=p.handler);let P=Date.now();if(N||L){let m=String(n.id),E=ke.receiver.createCancellationTokenSource(m);V[m]=E;try{let g;if(N)if(n.params===void 0){if(w!==void 0&&w.numberOfParams!==0){c(new d.ResponseError(d.ErrorCodes.InvalidParams,`Request ${n.method} defines ${w.numberOfParams} params but recevied none.`),n.method,P);return}g=N(E.token)}else if(Array.isArray(n.params)){if(w!==void 0&&w.parameterStructures===d.ParameterStructures.byName){c(new d.ResponseError(d.ErrorCodes.InvalidParams,`Request ${n.method} defines parameters by name but received parameters by position`),n.method,P);return}g=N(...n.params,E.token)}else{if(w!==void 0&&w.parameterStructures===d.ParameterStructures.byPosition){c(new d.ResponseError(d.ErrorCodes.InvalidParams,`Request ${n.method} defines parameters by position but received parameters by name`),n.method,P);return}g=N(n.params,E.token)}else L&&(g=L(n.method,n.params,E.token));let k=g;g?k.then?k.then(I=>{delete V[m],o(I,n.method,P)},I=>{delete V[m],I instanceof d.ResponseError?c(I,n.method,P):I&&O.string(I.message)?c(new d.ResponseError(d.ErrorCodes.InternalError,`Request ${n.method} failed with message: ${I.message}`),n.method,P):c(new d.ResponseError(d.ErrorCodes.InternalError,`Request ${n.method} failed unexpectedly without providing any details.`),n.method,P)}):(delete V[m],o(g,n.method,P)):(delete V[m],l(g,n.method,P))}catch(g){delete V[m],g instanceof d.ResponseError?o(g,n.method,P):g&&O.string(g.message)?c(new d.ResponseError(d.ErrorCodes.InternalError,`Request ${n.method} failed with message: ${g.message}`),n.method,P):c(new d.ResponseError(d.ErrorCodes.InternalError,`Request ${n.method} failed unexpectedly without providing any details.`),n.method,P)}}else c(new d.ResponseError(d.ErrorCodes.MethodNotFound,`Unhandled method ${n.method}`),n.method,P)}function Hr(n){if(!ce())if(n.id===null)n.error?s.error(`Received response message without id: Error is: 
${JSON.stringify(n.error,void 0,4)}`):s.error("Received response message without id. No further error information provided.");else{let o=String(n.id),c=ee[o];if(Yr(n,c),c){delete ee[o];try{if(n.error){let l=n.error;c.reject(new d.ResponseError(l.code,l.message,l.data))}else if(n.result!==void 0)c.resolve(n.result);else throw new Error("Should never happen.")}catch(l){l.message?s.error(`Response handler '${c.method}' failed with message: ${l.message}`):s.error(`Response handler '${c.method}' failed unexpectedly.`)}}}}function Ur(n){if(ce())return;let o,c;if(n.method===Re.type.method)c=l=>{let p=l.id,w=V[String(p)];w&&w.cancel()};else{let l=ae[n.method];l&&(c=l.handler,o=l.type)}if(c||Y)try{Gr(n),c?n.params===void 0?(o!==void 0&&o.numberOfParams!==0&&o.parameterStructures!==d.ParameterStructures.byName&&s.error(`Notification ${n.method} defines ${o.numberOfParams} params but recevied none.`),c()):Array.isArray(n.params)?(o!==void 0&&(o.parameterStructures===d.ParameterStructures.byName&&s.error(`Notification ${n.method} defines parameters by name but received parameters by position`),o.numberOfParams!==n.params.length&&s.error(`Notification ${n.method} defines ${o.numberOfParams} params but received ${n.params.length} argumennts`)),c(...n.params)):(o!==void 0&&o.parameterStructures===d.ParameterStructures.byPosition&&s.error(`Notification ${n.method} defines parameters by position but received parameters by name`),c(n.params)):Y&&Y(n.method,n.params)}catch(l){l.message?s.error(`Notification handler '${n.method}' failed with message: ${l.message}`):s.error(`Notification handler '${n.method}' failed unexpectedly.`)}else Vt.fire(n)}function Vr(n){if(!n){s.error("Received empty message.");return}s.error(`Received message which is neither a response nor a notification message:
${JSON.stringify(n,null,4)}`);let o=n;if(O.string(o.id)||O.number(o.id)){let c=String(o.id),l=ee[c];l&&l.reject(new Error("The received response has neither a result nor an error property."))}}function Qr(n){if(!(x===T.Off||!S))if(te===z.Text){let o;x===T.Verbose&&n.params&&(o=`Params: ${JSON.stringify(n.params,null,4)}

`),S.log(`Sending request '${n.method} - (${n.id})'.`,o)}else ue("send-request",n)}function Kr(n){if(!(x===T.Off||!S))if(te===z.Text){let o;x===T.Verbose&&(n.params?o=`Params: ${JSON.stringify(n.params,null,4)}

`:o=`No parameters provided.

`),S.log(`Sending notification '${n.method}'.`,o)}else ue("send-notification",n)}function Pe(n,o,c){if(!(x===T.Off||!S))if(te===z.Text){let l;x===T.Verbose&&(n.error&&n.error.data?l=`Error data: ${JSON.stringify(n.error.data,null,4)}

`:n.result?l=`Result: ${JSON.stringify(n.result,null,4)}

`:n.error===void 0&&(l=`No result returned.

`)),S.log(`Sending response '${o} - (${n.id})'. Processing request took ${Date.now()-c}ms`,l)}else ue("send-response",n)}function Xr(n){if(!(x===T.Off||!S))if(te===z.Text){let o;x===T.Verbose&&n.params&&(o=`Params: ${JSON.stringify(n.params,null,4)}

`),S.log(`Received request '${n.method} - (${n.id})'.`,o)}else ue("receive-request",n)}function Gr(n){if(!(x===T.Off||!S||n.method===$t.type.method))if(te===z.Text){let o;x===T.Verbose&&(n.params?o=`Params: ${JSON.stringify(n.params,null,4)}

`:o=`No parameters provided.

`),S.log(`Received notification '${n.method}'.`,o)}else ue("receive-notification",n)}function Yr(n,o){if(!(x===T.Off||!S))if(te===z.Text){let c;if(x===T.Verbose&&(n.error&&n.error.data?c=`Error data: ${JSON.stringify(n.error.data,null,4)}

`:n.result?c=`Result: ${JSON.stringify(n.result,null,4)}

`:n.error===void 0&&(c=`No result returned.

`)),o){let l=n.error?` Request failed: ${n.error.message} (${n.error.code}).`:"";S.log(`Received response '${o.method} - (${n.id})' in ${Date.now()-o.timerStart}ms.${l}`,c)}else S.log(`Received response ${n.id} without active response promise.`,c)}else ue("receive-response",n)}function ue(n,o){if(!S||x===T.Off)return;let c={isLSPMessage:!0,type:n,message:o,timestamp:Date.now()};S.log(c)}function ye(){if(Yt())throw new X($e.Closed,"Connection is closed.");if(ce())throw new X($e.Disposed,"Connection is disposed.")}function Zr(){if(Gt())throw new X($e.AlreadyListening,"Connection is already listening")}function en(){if(!Gt())throw new Error("Call listen() first.")}function be(n){return n===void 0?null:n}function tr(n){if(n!==null)return n}function rr(n){return n!=null&&!Array.isArray(n)&&typeof n=="object"}function ze(n,o){switch(n){case d.ParameterStructures.auto:return rr(o)?tr(o):[be(o)];case d.ParameterStructures.byName:if(!rr(o))throw new Error("Recevied parameters by name but param is not an object literal.");return tr(o);case d.ParameterStructures.byPosition:return[be(o)];default:throw new Error(`Unknown parameter structure ${n.toString()}`)}}function nr(n,o){let c,l=n.numberOfParams;switch(l){case 0:c=void 0;break;case 1:c=ze(n.parameterStructures,o[0]);break;default:c=[];for(let p=0;p<o.length&&p<l;p++)c.push(be(o[p]));if(o.length<l)for(let p=o.length;p<l;p++)c.push(null);break}return c}let le={sendNotification:(n,...o)=>{ye();let c,l;if(O.string(n)){c=n;let w=o[0],N=0,P=d.ParameterStructures.auto;d.ParameterStructures.is(w)&&(N=1,P=w);let m=o.length,E=m-N;switch(E){case 0:l=void 0;break;case 1:l=ze(P,o[N]);break;default:if(P===d.ParameterStructures.byName)throw new Error(`Recevied ${E} parameters for 'by Name' notification parameter structure.`);l=o.slice(N,m).map(g=>be(g));break}}else{let w=o;c=n.method,l=nr(n,w)}let p={jsonrpc:_,method:c,params:l};Kr(p),e.write(p)},onNotification:(n,o)=>{ye();let c;return O.func(n)?Y=n:o&&(O.string(n)?(c=n,ae[n]={type:void 0,handler:o}):(c=n.method,ae[n.method]={type:n,handler:o})),{dispose:()=>{c!==void 0?delete ae[c]:Y=void 0}}},onProgress:(n,o,c)=>{if(Ne.has(o))throw new Error(`Progress handler for token ${o} already registered`);return Ne.set(o,c),{dispose:()=>{Ne.delete(o)}}},sendProgress:(n,o,c)=>{le.sendNotification(De.type,{token:o,value:c})},onUnhandledProgress:Qt.event,sendRequest:(n,...o)=>{ye(),en();let c,l,p;if(O.string(n)){c=n;let m=o[0],E=o[o.length-1],g=0,k=d.ParameterStructures.auto;d.ParameterStructures.is(m)&&(g=1,k=m);let I=o.length;jt.CancellationToken.is(E)&&(I=I-1,p=E);let re=I-g;switch(re){case 0:l=void 0;break;case 1:l=ze(k,o[g]);break;default:if(k===d.ParameterStructures.byName)throw new Error(`Recevied ${re} parameters for 'by Name' request parameter structure.`);l=o.slice(g,I).map(K=>be(K));break}}else{let m=o;c=n.method,l=nr(n,m);let E=n.numberOfParams;p=jt.CancellationToken.is(m[E])?m[E]:void 0}let w=f++,N;return p&&(N=p.onCancellationRequested(()=>{ke.sender.sendCancellation(le,w)})),new Promise((m,E)=>{let g={jsonrpc:_,id:w,method:c,params:l},k=K=>{m(K),ke.sender.cleanup(w),N?.dispose()},I=K=>{E(K),ke.sender.cleanup(w),N?.dispose()},re={method:c,timerStart:Date.now(),resolve:k,reject:I};Qr(g);try{e.write(g)}catch(K){re.reject(new d.ResponseError(d.ErrorCodes.MessageWriteError,K.message?K.message:"Unknown reason")),re=null}re&&(ee[String(w)]=re)})},onRequest:(n,o)=>{ye();let c=null;return Lt.is(n)?(c=void 0,L=n):O.string(n)?(c=null,o!==void 0&&(c=n,D[n]={handler:o,type:void 0})):o!==void 0&&(c=n.method,D[n.method]={type:n,handler:o}),{dispose:()=>{c!==null&&(c!==void 0?delete D[c]:L=void 0)}}},trace:(n,o,c)=>{let l=!1,p=z.Text;c!==void 0&&(O.boolean(c)?l=c:(l=c.sendNotification||!1,p=c.traceFormat||z.Text)),x=n,te=p,x===T.Off?S=void 0:S=o,l&&!Yt()&&!ce()&&le.sendNotification(wr.type,{value:T.toString(n)})},onError:We.event,onClose:Ut.event,onUnhandledNotification:Vt.event,onDispose:Kt.event,end:()=>{e.end()},dispose:()=>{if(ce())return;Q=B.Disposed,Kt.fire(void 0);let n=new Error("Connection got disposed.");Object.keys(ee).forEach(o=>{ee[o].reject(n)}),ee=Object.create(null),V=Object.create(null),Z=new _r.LinkedMap,O.func(e.dispose)&&e.dispose(),O.func(t.dispose)&&t.dispose()},listen:()=>{ye(),Zr(),Q=B.Listening,t.listen(Fr)},inspect:()=>{vr.default().console.log("inspect")}};return le.onNotification($t.type,n=>{x===T.Off||!S||S.log(n.message,x===T.Verbose?n.verbose:void 0)}),le.onNotification(De.type,n=>{let o=Ne.get(n.token);o?o(n.value):Qt.fire(n)}),le}h.createMessageConnection=qn});var Bt=M(a=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.CancellationSenderStrategy=a.CancellationReceiverStrategy=a.ConnectionError=a.ConnectionErrors=a.LogTraceNotification=a.SetTraceNotification=a.TraceFormat=a.Trace=a.ProgressType=a.createMessageConnection=a.NullLogger=a.ConnectionOptions=a.ConnectionStrategy=a.WriteableStreamMessageWriter=a.AbstractMessageWriter=a.MessageWriter=a.ReadableStreamMessageReader=a.AbstractMessageReader=a.MessageReader=a.CancellationToken=a.CancellationTokenSource=a.Emitter=a.Event=a.Disposable=a.ParameterStructures=a.NotificationType9=a.NotificationType8=a.NotificationType7=a.NotificationType6=a.NotificationType5=a.NotificationType4=a.NotificationType3=a.NotificationType2=a.NotificationType1=a.NotificationType0=a.NotificationType=a.ErrorCodes=a.ResponseError=a.RequestType9=a.RequestType8=a.RequestType7=a.RequestType6=a.RequestType5=a.RequestType4=a.RequestType3=a.RequestType2=a.RequestType1=a.RequestType0=a.RequestType=a.RAL=void 0;a.CancellationStrategy=void 0;var b=wt();Object.defineProperty(a,"RequestType",{enumerable:!0,get:function(){return b.RequestType}});Object.defineProperty(a,"RequestType0",{enumerable:!0,get:function(){return b.RequestType0}});Object.defineProperty(a,"RequestType1",{enumerable:!0,get:function(){return b.RequestType1}});Object.defineProperty(a,"RequestType2",{enumerable:!0,get:function(){return b.RequestType2}});Object.defineProperty(a,"RequestType3",{enumerable:!0,get:function(){return b.RequestType3}});Object.defineProperty(a,"RequestType4",{enumerable:!0,get:function(){return b.RequestType4}});Object.defineProperty(a,"RequestType5",{enumerable:!0,get:function(){return b.RequestType5}});Object.defineProperty(a,"RequestType6",{enumerable:!0,get:function(){return b.RequestType6}});Object.defineProperty(a,"RequestType7",{enumerable:!0,get:function(){return b.RequestType7}});Object.defineProperty(a,"RequestType8",{enumerable:!0,get:function(){return b.RequestType8}});Object.defineProperty(a,"RequestType9",{enumerable:!0,get:function(){return b.RequestType9}});Object.defineProperty(a,"ResponseError",{enumerable:!0,get:function(){return b.ResponseError}});Object.defineProperty(a,"ErrorCodes",{enumerable:!0,get:function(){return b.ErrorCodes}});Object.defineProperty(a,"NotificationType",{enumerable:!0,get:function(){return b.NotificationType}});Object.defineProperty(a,"NotificationType0",{enumerable:!0,get:function(){return b.NotificationType0}});Object.defineProperty(a,"NotificationType1",{enumerable:!0,get:function(){return b.NotificationType1}});Object.defineProperty(a,"NotificationType2",{enumerable:!0,get:function(){return b.NotificationType2}});Object.defineProperty(a,"NotificationType3",{enumerable:!0,get:function(){return b.NotificationType3}});Object.defineProperty(a,"NotificationType4",{enumerable:!0,get:function(){return b.NotificationType4}});Object.defineProperty(a,"NotificationType5",{enumerable:!0,get:function(){return b.NotificationType5}});Object.defineProperty(a,"NotificationType6",{enumerable:!0,get:function(){return b.NotificationType6}});Object.defineProperty(a,"NotificationType7",{enumerable:!0,get:function(){return b.NotificationType7}});Object.defineProperty(a,"NotificationType8",{enumerable:!0,get:function(){return b.NotificationType8}});Object.defineProperty(a,"NotificationType9",{enumerable:!0,get:function(){return b.NotificationType9}});Object.defineProperty(a,"ParameterStructures",{enumerable:!0,get:function(){return b.ParameterStructures}});var Ln=Ue();Object.defineProperty(a,"Disposable",{enumerable:!0,get:function(){return Ln.Disposable}});var Tr=ie();Object.defineProperty(a,"Event",{enumerable:!0,get:function(){return Tr.Event}});Object.defineProperty(a,"Emitter",{enumerable:!0,get:function(){return Tr.Emitter}});var Sr=St();Object.defineProperty(a,"CancellationTokenSource",{enumerable:!0,get:function(){return Sr.CancellationTokenSource}});Object.defineProperty(a,"CancellationToken",{enumerable:!0,get:function(){return Sr.CancellationToken}});var Wt=fr();Object.defineProperty(a,"MessageReader",{enumerable:!0,get:function(){return Wt.MessageReader}});Object.defineProperty(a,"AbstractMessageReader",{enumerable:!0,get:function(){return Wt.AbstractMessageReader}});Object.defineProperty(a,"ReadableStreamMessageReader",{enumerable:!0,get:function(){return Wt.ReadableStreamMessageReader}});var zt=yr();Object.defineProperty(a,"MessageWriter",{enumerable:!0,get:function(){return zt.MessageWriter}});Object.defineProperty(a,"AbstractMessageWriter",{enumerable:!0,get:function(){return zt.AbstractMessageWriter}});Object.defineProperty(a,"WriteableStreamMessageWriter",{enumerable:!0,get:function(){return zt.WriteableStreamMessageWriter}});var A=Rr();Object.defineProperty(a,"ConnectionStrategy",{enumerable:!0,get:function(){return A.ConnectionStrategy}});Object.defineProperty(a,"ConnectionOptions",{enumerable:!0,get:function(){return A.ConnectionOptions}});Object.defineProperty(a,"NullLogger",{enumerable:!0,get:function(){return A.NullLogger}});Object.defineProperty(a,"createMessageConnection",{enumerable:!0,get:function(){return A.createMessageConnection}});Object.defineProperty(a,"ProgressType",{enumerable:!0,get:function(){return A.ProgressType}});Object.defineProperty(a,"Trace",{enumerable:!0,get:function(){return A.Trace}});Object.defineProperty(a,"TraceFormat",{enumerable:!0,get:function(){return A.TraceFormat}});Object.defineProperty(a,"SetTraceNotification",{enumerable:!0,get:function(){return A.SetTraceNotification}});Object.defineProperty(a,"LogTraceNotification",{enumerable:!0,get:function(){return A.LogTraceNotification}});Object.defineProperty(a,"ConnectionErrors",{enumerable:!0,get:function(){return A.ConnectionErrors}});Object.defineProperty(a,"ConnectionError",{enumerable:!0,get:function(){return A.ConnectionError}});Object.defineProperty(a,"CancellationReceiverStrategy",{enumerable:!0,get:function(){return A.CancellationReceiverStrategy}});Object.defineProperty(a,"CancellationSenderStrategy",{enumerable:!0,get:function(){return A.CancellationSenderStrategy}});Object.defineProperty(a,"CancellationStrategy",{enumerable:!0,get:function(){return A.CancellationStrategy}});var $n=F();a.RAL=$n.default});var Nr=M(W=>{"use strict";var Dn=W&&W.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r),Object.defineProperty(t,i,{enumerable:!0,get:function(){return e[r]}})}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),In=W&&W.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Dn(e,t,r)};Object.defineProperty(W,"__esModule",{value:!0});W.createMessageConnection=W.BrowserMessageWriter=W.BrowserMessageReader=void 0;var An=ar();An.default.install();var ge=Bt();In(Bt(),W);var Ft=class extends ge.AbstractMessageReader{constructor(e){super(),this._onData=new ge.Emitter,this._messageListener=r=>{this._onData.fire(r.data)},e.addEventListener("error",r=>this.fireError(r)),e.onmessage=this._messageListener}listen(e){return this._onData.event(e)}};W.BrowserMessageReader=Ft;var Jt=class extends ge.AbstractMessageWriter{constructor(e){super(),this.context=e,this.errorCount=0,e.addEventListener("error",r=>this.fireError(r))}write(e){try{return this.context.postMessage(e),Promise.resolve()}catch(r){return this.handleError(r,e),Promise.reject(r)}}handleError(e,r){this.errorCount++,this.fireError(e,r,this.errorCount)}end(){}};W.BrowserMessageWriter=Jt;function Wn(t,e,r,i){return r===void 0&&(r=ge.NullLogger),ge.ConnectionStrategy.is(i)&&(i={connectionStrategy:i}),ge.createMessageConnection(t,e,r,i)}W.createMessageConnection=Wn});var Ie=M((ai,kr)=>{"use strict";kr.exports=Nr()});var Lr=Be(Ie(),1);function Pr(t,e,r){return{sendCancellation:(i,s)=>t(s),cleanup:e??(()=>{}),dispose:r}}var G=Be(Ie(),1);var Te=Be(Ie(),1),Cr=new Te.RequestType2("addNumbers"),Ht=new Te.RequestType2("addNumbersSlow"),Or=new Te.RequestType1("hello");function R(t=""){document.getElementById("log").innerText+=`${t}
`}function Se(t){throw R(t),new Error(t)}async function xr(t,e){let r=G.createMessageConnection(new G.BrowserMessageReader(t),new G.BrowserMessageWriter(t),void 0,{cancellationStrategy:e});r.listen();async function i(s){let f=performance.now();try{return await s()}finally{R(`took ${Math.round(performance.now()-f)} ms`)}}R(),await i(async()=>{R("calling addNumbers(1, 2)"),R(`result = ${await r.sendRequest(Cr,1,2)}`)}),R(),await i(async()=>{R("addNumbersSlow(1, 2)"),R(`result = ${await r.sendRequest(Ht,1,2)}`)}),R(),await i(async()=>{let s=new G.CancellationTokenSource;setTimeout(()=>{R("triggering cancellation"),s.cancel()},1e3);try{R("addNumbersSlow(1, 2) with cancellation after 1 second");let f=await r.sendRequest(Ht,1,2,s.token);R(`unexpected result = ${f}`)}catch(f){R(`threw ${f}`)}}),R(),await i(async()=>{R('hello("worker"), implemented as an RPC call to the main page via the service worker');try{R(`result = ${await r.sendRequest(Or,"worker")}`)}catch(s){R(`threw ${s}`)}})}function qr(t){return!!(t&&typeof t.id=="string")}var Mr;(e=>{function t(r){return r.data.type==="setCanceled"&&qr(r.source)&&(typeof r.data.id=="number"||typeof r.data.id=="string")}e.is=t})(Mr||(Mr={}));var jr;(e=>{function t(r){return r.data.type==="deleteCanceled"&&qr(r.source)&&(typeof r.data.id=="number"||typeof r.data.id=="string")}e.is=t})(jr||(jr={}));navigator.serviceWorker||Se("Service workers are not available");zn();async function zn(){R("registering service worker");let t=await navigator.serviceWorker.register("./sw.js",{scope:"./"});if(t.installing){let r=t.installing||t.waiting;r.onstatechange=()=>{r.state==="installed"&&(console.log("state change reload"),window.location.reload())},Se("waiting for service worker")}else t.active?navigator.serviceWorker.controller||Se("The service worker can't be contacted, likely due to a Ctrl+Shift+R. Try reloading."):Se("no service worker");navigator.serviceWorker.addEventListener("message",r=>{let i=r.data;if(i.type==="log")R(`sw: ${i.message}`);else if(i.type==="rpc"){let v=function(q){f.postMessage(q)},{request:s,port:f}=i;Jn(s).then(v).catch(q=>v({error:{code:-32e3,message:q.toString()}}))}}),R("starting web worker");let e=new Worker("./sw-worker.js");xr(e,{receiver:Lr.CancellationReceiverStrategy.Message,sender:Pr(Bn,Fn)})}function Bn(t){let e={type:"setCanceled",id:t};globalThis.navigator.serviceWorker.controller?.postMessage(e)}function Fn(t){let e={type:"deleteCanceled",id:t};globalThis.navigator.serviceWorker.controller?.postMessage(e)}async function Jn(t){if(t.method==="hello")return{result:`Hello from the page, ${t.params}!`};throw new Error(`unsupported method ${t.method}`)}})();
//# sourceMappingURL=sw-page.js.map
